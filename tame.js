/*!
 * TAME [TwinCAT ADS Made Easy] V4.0 alpha 151231
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={version:"V4.0 alpha 151231",weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(f){function k(ar){try{window.console.log(ar)}catch(at){alert(ar)}}var ac=this,l={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,HandleByName:61443,ValueByHandle:61445,ReleaseHandle:61446,SumRd:61568,SumWr:61569,SumRdWr:61570},C={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},V=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],g=(typeof f.language==="string")?f.language:"ge",m=(function(){var e={},at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ar;for(ar=0;ar<at.length;ar++){e[ar]=at.charAt(ar)}return e}()),p=(function(){var e={},at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ar;for(ar=0;ar<at.length;ar++){e[at.charAt(ar)]=ar}return e}()),a=0,F=[0],R={},aq={},A={},b=0,w=0,O={},s=[];k("TAME library version: "+TAME.version);if(typeof f.serviceUrl!=="string"){k("TAME library error: Service URL is not a string!");return}if(typeof f.amsNetId!=="string"&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){k("TAME library error: NetId is not defined and there is no URL for fetching the TPY file or fetching the symbols is deactivated!");return}if(f.amsPort===undefined&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){f.amsPort="801";k("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof f.amsPort==="number"){k("TAME library warning: AMS port number is not a string! Trying to convert it.");f.amsPort=f.amsPort.toString(10)}}if(parseInt(f.amsPort,10)<801||parseInt(f.amsPort,10)>891){k("TAME library error: AMS Port Number ("+parseInt(f.amsPort,10)+") is out of range (801-891)!");return}if(f.dataAlign4===true){a=4}else{if(f.alignment===undefined&&(typeof f.configFileUrl!=="string"||f.dontFetchSymbols===true)){a=1}else{if(typeof f.alignment==="string"){a=parseInt(f.alignment,10)}else{if(typeof f.alignment==="number"){a=f.alignment}}}}if(f.syncXmlHttp===true){k('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests will be used by default.')}if(typeof f.serviceUser==="string"&&typeof f.servicePassword==="string"){k("TAME library info: Username and password set. Authenticated requests will be used.")}else{f.serviceUser=null;f.servicePassword=null}if(f.useHandles===true){k('TAME library info: The "useHandles" parameter was set. Handles will be used for all requests.')}this.dateNames={weekdShort:TAME.weekdShortNames[g],weekdLong:TAME.weekdLongNames[g],monthsShort:TAME.monthsShortNames[g],monthsLong:TAME.monthsLongNames[g]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;this.symTableReady=false;this.dataTypeTableReady=false;this.handleCacheReady=false;function B(e,au,at,aw,az){var av=[],ay=0,ax=[],ar=0;if(typeof e==="number"){av[0]=e.toString(10)}else{if(typeof e==="string"){av=e.split(".")}else{k("TAME library error: Can't parse name of object/variable. Name is not a string or number!");k(e);return}}if(at===undefined){at=window}ay=av.length-1;while(ar<ay){if(av[ar].charAt(av[ar].length-1)==="]"){ax=av[ar].substring(0,av[ar].length-1).split("[");at=at[ax[0]][ax[1]]}else{if(at[av[ar]]===undefined){at[av[ar]]=[]}at=at[av[ar]]}ar++}if(av[ar].charAt(av[ar].length-1)==="]"){ax=av[ar].substring(0,av[ar].length-1).split("[");at=at[ax[0]];if(au!==undefined){if(typeof aw==="string"){au=aw+au}if(typeof az==="string"){au=au+az}at[ax[1]]=au}return at[ax[1]]}if(au!==undefined){if(typeof aw==="string"){au=aw+au}if(typeof az==="string"){au=au+az}at[av[ar]]=au}return at[av[ar]]}function ao(e){if(e===undefined){return false}if(!isNaN(e)&&e>0&&e<=ac.maxStringLen){return true}k("TAME library error: User defined string length not valid! length: "+e);k("Max. string length: "+ac.maxStringLen);return false}function z(at){var ar;if(at.addr){if(typeof at.addr==="string"&&at.addr.charAt(0)==="%"){if(at.addr.charAt(2)==="X"){ar=l[at.addr.substr(1,2)]}else{ar=l[at.addr.substr(1,1)]}}else{k('TAME library error: Wrong address definition, should be a string and start with "%"!');k(at);return}}else{if(at.useHandle===true||f.useHandles===true){ar=l.ValueByHandle}else{if(at.symbolName){if(typeof at.symbolName==="string"){try{ar=R[at.symbolName].indexGroup}catch(au){k("TAME library error: Can't get the IndexGroup for this request!");k("TAME library error: Please check the variable name.");k(au);k(at);return}}else{k("TAME library error: Varible name should be a string!");k(at);return}}else{k("TAME library error: No name, address or handle for the variable/request defined!");k(at);return}}}if(isNaN(ar)){k("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");k(at)}return ar}function j(ay){var av,at="",ax=[],au,aA,ar,az,aC,aB;if(ay.addr){if(typeof ay.addr==="string"&&ay.addr.charAt(0)==="%"){if(ay.addr.charAt(2)==="X"){at=ay.addr.substr(3);ax=at.split(".");av=parseInt(ax[0],10)*8+parseInt(ax[1],10)}else{av=parseInt(ay.addr.substr(3),10);if(typeof ay.addrOffset==="number"){av+=ay.addrOffset}}}else{k('TAME library error: Wrong address definition, should be a string and start with "%"!');k(ay);return}}else{if(ay.useHandle===true||f.useHandles===true){if(ac.handleCacheReady===true){av=O[ay.fullSymbolName];if(isNaN(av)){k("TAME library error: Could not get the handle for this symbol name: "+ay.fullSymbolName);k(ay);return}}else{k("TAME library error: Could not get the handle for this request. Handle cache is not ready.");k(ay);return}}else{if(ay.symbolName){if(typeof ay.symbolName==="string"){try{av=R[ay.symbolName].indexOffset;if(typeof ay.symbolNameArrIdx==="number"){av+=R[ay.symbolName].itemSize*(ay.symbolNameArrIdx-R[ay.symbolName].arrStartIdx)}if(typeof ay.addrOffset==="number"){av+=ay.addrOffset}if(typeof ay.offs==="string"){av+=parseInt(ay.offs,10)/8}else{if(typeof ay.offs==="number"){av+=ay.offs/8}}if(ay.dataTypeNames.length>0){ar=ay.dataTypeNames;aA=R[ay.symbolName].dataType;for(au=0;au<ar.length;au++){aB=aq[aA].subItems[ar[au]];av+=aB.bitOffset/8;if(typeof ay.dataTypeArrIdx[au]==="number"){av+=aB.itemSize*(ay.dataTypeArrIdx[au]-aB.arrStartIdx)}aA=aq[aA].subItems[ar[au]].dataType}}}catch(aw){k("TAME library error: Can't get the IndexOffset for this request!");k("TAME library error: Please check the variable definition (name/offs/subitem).");k(aw);k(ay);return}}else{k("TAME library error: Varible name should be a string!");k(ay);return}}else{k("TAME library error: Neither a name nor an address for the variable/request defined!");k(ay);return}}}if(isNaN(av)){k("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");k("IndexOffset: "+av);k(ay)}return av}function am(aA){var ar={},az,au;if(typeof aA.name==="string"){aA.name=aA.name.toUpperCase();az=aA.name.split(".")}else{return ar}ar.fullSymbolName=aA.name;if(az[0]===""){ar.symbolName="."+az[1]}else{ar.symbolName=az[0]+"."+az[1]}if(ar.symbolName.charAt(ar.symbolName.length-1)==="]"){au=ar.symbolName.substring(0,ar.symbolName.length-1).split("[");ar.symbolName=au[0];ar.symbolNameArrIdx=parseInt(au[1],10)}ar.dataTypeNames=az.slice(2);var av=[],ax,ay,at;if(ac.symTableReady&&ac.dataTypeTableReady&&ar.dataTypeNames.length>0){ax=ar.dataTypeNames;ay=R[ar.symbolName].dataType;ar.dataTypeArrIdx=[];at=0;do{if(ax[at].charAt(ax[at].length-1)==="]"){au=ax[at].substring(0,ax[at].length-1).split("[");ax[at]=au[0];ar.dataTypeArrIdx[at]=parseInt(au[1],10)}if(aq[ay].subItems[ax[at]].pointer===true){k("TAME library error: PLC variable "+[ax[at]]+" is a pointer! Can't get the variable value.")}if(at===ax.length-1){break}ay=aq[ay].subItems[ax[at]].dataType;at++}while(at<ax.length);try{if(aA.type===undefined){ar.type=aq[ay].subItems[ax[at]].type}ar.arrayLength=aq[ay].subItems[ax[at]].arrayLength;ar.arrayDataType=aq[ay].subItems[ax[at]].arrayDataType;ar.dataType=aq[ay].subItems[ax[at]].dataType;ar.itemSize=aq[ay].subItems[ax[at]].itemSize;if(ar.size===undefined){ar.size=aq[ay].subItems[ax[at]].size}ar.bitOffset=aq[ay].subItems[ax[at]].bitOffset;ar.offs=aA.offs;if(ar.type==="STRING"||ar.arrayDataType==="STRING"){ar.stringLength=aq[ay].subItems[ax[at]].stringLength;ar.format=ar.stringLength}else{if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(ar.dataTypeArrIdx[at]!==undefined&&ar.type==="ARRAY"){ar.type=aq[ay].subItems[ax[at]].arrayDataType;ar.size=aq[ay].subItems[ax[at]].itemSize}}catch(aw){k("TAME library error: A problem occured while reading a data type from the data type table!");k(aw);k(aA)}}else{if(ac.symTableReady){try{if(aA.type===undefined){ar.type=R[ar.symbolName].type}ar.arrayLength=R[ar.symbolName].arrayLength;ar.arrayDataType=R[ar.symbolName].arrayDataType;ar.dataType=R[ar.symbolName].dataType;ar.itemSize=R[ar.symbolName].itemSize;if(ar.size===undefined){ar.size=R[ar.symbolName].size}ar.bitOffset=R[ar.symbolName].bitOffset;ar.offs=aA.offs;if(ar.type==="STRING"||ar.arrayDataType==="STRING"){ar.stringLength=R[ar.symbolName].stringLength;ar.format=ar.stringLength}else{if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(ar.symbolNameArrIdx!==undefined&&ar.type==="ARRAY"){ar.type=R[ar.symbolName].arrayDataType;ar.size=R[ar.symbolName].itemSize}}catch(aw){k("TAME library error: A problem occured while reading a data type from the symbol table!");k(aw);k(aA)}}}if(typeof aA.type=="string"){av=aA.type.split(".");ar.type=av[0];if(av.length>2){av[1]=av.slice(1).join(".")}if(ar.type==="STRING"){av[1]=parseInt(av[1],10);if(ao(av[1])){ar.format=av[1]}else{ar.format=C.STRING;k("TAME library warning: Length of string variable not defined: "+aA.name);k("TAME library warning: A length of 80 characters (TwinCAT default) will be used.")}ar.stringLength=ar.format;ar.size=ar.format++}else{if(ar.type==="ARRAY"){}else{if(ar.type==="USER"){}else{ar.format=av[1];ar.size=C[ar.type]}}}if(typeof aA.format==="string"){ar.format=aA.format}else{if(typeof aA.decPlaces==="number"){ar.format=aA.decPlaces}else{if(typeof aA.dp==="number"){ar.format=aA.dp}}}}if(typeof ar.type!="string"){k("TAME library error: Could not get the type of the item!");k(aA)}return ar}function ab(){var at;if(window.XMLHttpRequest){at=new window.XMLHttpRequest()}else{try{at=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(au){try{at=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(ar){at=null;k("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return at}function v(e){if(e.reqDescr===undefined){e.reqDescr={}}else{if(e.reqDescr.debug){k(e)}}e.send=function(){var ar,at;if(typeof this.reqDescr.id==="number"&&F[this.reqDescr.id]>0){k("TAME library warning: Request dropped (last request with ID "+e.reqDescr.id+" not finished!)");F[this.reqDescr.id]++;if(F[this.reqDescr.id]<=ac.maxDropReq){return}F[this.reqDescr.id]=0}if(e.sync===true){at=false}else{if(this.reqDescr.sync===true){at=false}else{if(this.reqDescr.sync===false){at=true}else{if(f.syncXmlHttp===true){at=false}else{at=true}}}}this.xmlHttpReq=ab();ar="<?xml version='1.0' encoding='utf-8'?>";ar+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";ar+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";ar+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";ar+="<soap:Body><q1:";ar+=this.method;ar+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";ar+=f.amsNetId;ar+="</netId><nPort xsi:type='xsd:int'>";ar+=f.amsPort;ar+="</nPort>";if(this.indexGroup!==undefined){ar+="<indexGroup xsi:type='xsd:unsignedInt'>";ar+=this.indexGroup;ar+="</indexGroup>"}if(this.indexOffset!==undefined){ar+="<indexOffset xsi:type='xsd:unsignedInt'>";ar+=this.indexOffset;ar+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){ar+="<cbRdLen xsi:type='xsd:int'>";ar+=this.reqDescr.readLength;ar+="</cbRdLen>"}if(this.pData&&this.pData.length>0){ar+="<pData xsi:type='xsd:base64Binary'>";ar+=this.pData;ar+="</pData>"}if(this.pwrData&&this.pwrData.length>0){ar+="<pwrData xsi:type='xsd:base64Binary'>";ar+=this.pwrData;ar+="</pwrData>"}ar+="</q1:";ar+=this.method;ar+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",f.serviceUrl,at,f.serviceUser,f.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(at===true){this.xmlHttpReq.onreadystatechange=function(){if((e.xmlHttpReq.readyState===4)&&(e.xmlHttpReq.status===200)){ac.parseResponse(e)}};this.xmlHttpReq.send(ar)}else{this.xmlHttpReq.send(ar);ac.parseResponse(e)}if(typeof this.reqDescr.id==="number"){F[this.reqDescr.id]=1}}};return e}function W(au,at,ar,e){var av;if(typeof au.val==="string"){if(at==="REAL"||at==="LREAL"){av=parseFloat(au.val)}else{av=parseInt(au.val,10)}}else{if(typeof au.val==="number"){av=au.val}else{k("TAME library error: Wrong variable type for a numeric variable in write request!");k("TAME library error: Variable type should be number or string, but is "+typeof au.val);k(au);av=0}}if(isNaN(av)){av=0;k("TAME library error: Value of a numeric variable in write request is not a number.");k(au)}if(ac.useCheckBounds===true){if(at==="LREAL"){if(!isFinite(av)){k("TAME library warning: Limit for LREAL value exceeded!");k("Upper limit: "+Number.MAX_VALUE);k("Lower limit: "+Number.MIN_VALUE);k("value: "+av);k(au)}}else{if(at==="REAL"){if(av>0){if(av<1.175495e-38){k("TAME library warning: Lower limit for positive REAL value exceeded!");k("limit: 1.175495e-38");k("value: "+av);k(au);av=1.175495e-38}else{if(av>3.402823e+38){k("TAME library warning: Upper limit for positive REAL value exceeded!");k("limit: 3.402823e+38");k("value: "+av);k(au);av=3.402823e+38}}}else{if(av<0){if(av>-1.175495e-38){k("TAME library warning: Upper limit for negative REAL value exceeded!");k("limit: -1.175495e-38");k("value: "+av);k(au);av=-1.175495e-38}else{if(av<-3.402823e+38){k("TAME library warning: Lower limit for negative REAL value exceeded!");k("limit: -3.402823e+38");k("value: "+av);k(au);av=-3.402823e+38}}}}}else{if(av<ar){k("TAME library warning: Lower limit for numeric value exceeded!");k("type: "+at);k("limit: "+ar);k("value: "+av);k(au);av=ar}else{if(av>e){k("TAME library warning: Upper limit for numeric value exceeded!");k("type: "+at);k("limit: "+e);k("value: "+av);k(au);av=e}}}}}return av}function ak(au){var e=[],av,ar,at;if(typeof au.type==="string"){e=au.type.split(".");if(e.length>2){e[1]=e.slice(1).join(".")}}else{k("TAME library error: Could not get the type of the item (function getTypeAndFormat())!");k(au)}return e}function h(ar){var au={},e,at;at=aq[ar].subItems;for(e in at){if(at[e].type==="USER"){k("TAME library error: Automatic creating of nested structures is not supported (yet)!");au[e]=h(at[e].dataType)}else{if(at.hasOwnProperty(e)){au[e]=at[e].fullType}}}return au}function L(e){if((e>=97)&&(e<=102)){return(e-87)}if((e>=65)&&(e<=70)){return(e-55)}if((e>=48)&&(e<=57)){return(e-48)}return 0}function ai(av,ar){var e=[],au=av.toString(16),at;while(au.length<ar*2){au="0"+au}for(at=0;at<ar;at++){e[(ar-1)-at]=((L(au.charCodeAt(at*2))*16)+L(au.charCodeAt((at*2)+1)))}return e}function r(ar){var av=0,ay=0,aw,e,au,ax,at;e=Math.abs(ar);if(ar!==0){for(at=128;at>-127;at--){au=e/Math.pow(2,at);if(au>=2){break}ax=at;aw=au}ax+=127;aw=aw.toString(2);for(at=2;at<25;at++){av<<=1;if(aw.charAt(at)==="1"){av+=1}}if(aw.charAt(25)==="1"){av+=1}ay=ax;ay<<=23;ay+=av;if(ar<0){ay+=2147483648}}return ay}function E(ax){var at=0,az=0,au={part1:0,part2:0},aA,aw,ar,e,ay,av;aA=Math.abs(ax);if(ax!==0){for(av=1024;av>=-1023;av--){aw=aA/Math.pow(2,av);if(aw>=2){break}ar=av;ay=aw}ar+=1023;ay=ay.toString(2);for(av=2;av<22;av++){at<<=1;if(ay.charAt(av)==="1"){at+=1}}if(ay.charAt(av)==="1"){e=true}av++;for(av;av<54;av++){az<<=1;if(ay.charAt(av)==="1"){az+=1}}au.part1=ar;au.part1<<=20;au.part1+=at;if(ax<0){au.part1+=2147483648}au.part2=az;if(e===true){au.part2+=2147483648}}return au}function M(at,ar){var e;switch(ar){case"#d":case"#dd":e=at*86400000;break;case"#h":case"#hh":e=at*3600000;break;case"#m":case"#mm":e=at*60000;break;case"#s":case"#ss":e=at*1000;break;case"#ms":case"#msmsms":e=at;break;default:e=at;break}return e}function D(ay,aA){var e=aA.split("#"),ax=e.length,az=/:|\.|-|_/,at=0,ar=0,av,au,aw,aB;for(au=1;au<ax;au++){if(az.test(e[au])===true){aB=true}}if(aB!==true){k("TAME library error: No separator ( : . - _ ) for TOD string found!");k("String: "+ay);k("Format: "+aA);return 0}aw=ay.split(az);for(au=1;au<ax;au++){switch(e[au]){case"h":case"hh":av=parseInt(aw[ar],10)*3600000;ar++;break;case"m":case"mm":av=parseInt(aw[ar],10)*60000;ar++;break;case"s":case"ss":av=parseInt(aw[ar],10)*1000;ar++;break;case"ms":case"msmsms":av=parseInt(aw[ar],10);ar++;break;default:av=0}at+=av}return at}function o(ax){var aw=m,au=0,ar="",av,at,e;while(au<ax.length){av=ax[au++];at=ax[au++];e=ax[au++];ar=ar+aw[av>>2]+aw[((av&3)<<4)|(at>>4)]+(isNaN(at)?"=":aw[(((at&15)<<2)|(e>>6))])+((isNaN(at)||isNaN(e))?"=":aw[e&63])}return ar}function d(ax,av,aw,au){var az=[],e,ay,ar,at;if(ax.val===undefined){switch(av){case"STRING":ax.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":ax.val=new Date();break;default:ax.val=0;break}k("TAME library warning: Value of a variable in write request is not defined!");k(ax)}switch(av){case"BOOL":if(ax.val){az[0]=1}else{az[0]=0}break;case"BYTE":case"USINT":e=W(ax,av,0,255);az=ai(e,au);break;case"SINT":e=W(ax,av,-128,127);if(e<0){e=e+256}az=ai(e,au);break;case"WORD":case"UINT":e=W(ax,av,0,65535);az=ai(e,au);break;case"INT":case"INT16":e=W(ax,av,-32768,32767);if(e<0){e=e+65536}az=ai(e,au);break;case"INT1DP":ax.val=Math.round(ax.val*10);e=W(ax,av,-32768,32767);if(e<0){e=e+65536}az=ai(e,au);break;case"DWORD":case"UDINT":e=W(ax,av,0,4294967295);az=ai(e,au);break;case"DINT":e=W(ax,av,-2147483648,2147483647);if(e<0){e=e+4294967296}az=ai(e,au);break;case"REAL":e=W(ax,av);e=r(e);az=ai(e,au);break;case"LREAL":e=W(ax,av);e=E(e);az=ai(e.part2,4);az=az.concat(ai(e.part1,4));break;case"DATE":if(typeof ax.val==="object"){ax.val.setHours(0);ax.val.setMinutes(0);ax.val.setSeconds(0);e=ax.val.getTime()/1000-ax.val.getTimezoneOffset()*60}else{k("TAME library error: Value of a DATE variable in write request is not a date object!");k(ax)}az=ai(e,au);break;case"DT":case"DATE_AND_TIME":if(typeof ax.val==="object"){e=ax.val.getTime()/1000-ax.val.getTimezoneOffset()*60}else{k("TAME library error: Value of a DT variable in write request is not a date object!");k(ax)}az=ai(e,au);break;case"TOD":case"TIME_OF_DAY":if(typeof ax.val==="object"){ax.val.setYear(1970);ax.val.setMonth(0);ax.val.setDate(1);e=ax.val.getTime()-ax.val.getTimezoneOffset()*60000}else{if(typeof ax.val==="string"){if(aw===""||aw===undefined){aw="#hh#:#mm";k("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");k(ax)}e=D(ax.val,aw)}else{k("TAME library error: TOD value in write request is wether a date object nor a string!");k(ax)}}az=ai(e,au);break;case"STRING":ay=(aw===undefined)?C.STRING:parseInt(aw,10);if(ao(ay)){ar=ay<ax.val.length?ay:ax.val.length;for(at=0;at<ar;at++){az[at]=ax.val.charCodeAt(at)}for(at;at<ay;at++){az[at]=0}az[at]=0}break;case"TIME":e=parseInt(ax.val,10);if(isNaN(e)){k("TAME library warning: Value of a TIME variable in write request is not defined!");k(ax);e=0}e=M(e,aw);if(e<0){e=0;k("TAME library warning: Lower limit for TIME variable in write request exceeded!)");k("value: "+ax.val+aw);k(ax)}else{if(e>4294967295){e=4294967295;k("TAME library warning: Upper limit for TIME variable in write request exceeded!)");k("value: "+ax.val+aw);k(ax)}}az=ai(e,au);break;case"EndStruct":break;default:k("TAME library error: Unknown data type in write request : "+av);break}return az}function t(ar){var e=ar.toString(16);if((e.length%2)!==0){e="0"+e}return e}function i(ar,e){e=(isNaN(e))?0:e;var at=ar.toString(10);while(at.length<e){at="0"+at}return at}function ap(ax,aw){var e=aw.split("#"),av=e.length,ar="",au,at;for(at=1;at<av;at++){switch(e[at]){case"D":au=ax.getDate();break;case"DD":au=ax.getDate();au=i(au,2);break;case"WD":au=ax.getDay();break;case"WKD":au=ac.dateNames.weekdShort[ax.getDay()];break;case"WEEKDAY":au=ac.dateNames.weekdLong[ax.getDay()];break;case"M":au=ax.getMonth()+1;break;case"MM":au=ax.getMonth()+1;au=i(au,2);break;case"MON":au=ac.dateNames.monthsShort[ax.getMonth()];break;case"MONTH":au=ac.dateNames.monthsLong[ax.getMonth()];break;case"YY":au=ax.getYear();while(au>100){au-=100}break;case"YYYY":au=ax.getFullYear();break;case"h":au=ax.getHours();break;case"hh":au=ax.getHours();au=i(au,2);break;case"m":au=ax.getMinutes();break;case"mm":au=ax.getMinutes();au=i(au,2);break;case"s":au=ax.getSeconds();break;case"ss":au=ax.getSeconds();au=i(au,2);break;case"ms":au=ax.getMilliseconds();break;case"msmsms":au=ax.getMilliseconds();au=i(au,3);break;default:au=e[at];break}ar=ar+au}return ar}function K(ax,aw){var e=aw.split("#"),av=e.length,ar="",au,at;for(at=1;at<av;at++){switch(e[at]){case"d":if(av<=2){au=ax/86400000}else{au=Math.floor(ax/86400000);ax=ax%86400000}break;case"dd":if(av<=2){au=ax/86400000}else{au=Math.floor(ax/86400000);ax=ax%86400000}au=i(au,2);break;case"h":if(av<=2){au=ax/3600000}else{au=Math.floor(ax/3600000);ax=ax%3600000}break;case"hh":if(av<=2){au=ax/3600000}else{au=Math.floor(ax/3600000);ax=ax%3600000}au=i(au,2);break;case"m":if(av<=2){au=ax/60000}else{au=Math.floor(ax/60000);ax=ax%60000}break;case"mm":if(av<=2){au=ax/60000}else{au=Math.floor(ax/60000);ax=ax%60000}au=i(au,2);break;case"s":if(av<=2){au=ax/1000}else{au=Math.floor(ax/1000);ax=ax%1000}break;case"ss":if(av<=2){au=ax/1000}else{au=Math.floor(ax/1000);ax=ax%1000}au=i(au,2);break;case"ms":au=ax;break;case"msmsms":au=ax;au=i(au,3);break;default:au=e[at];break}ar=ar+au}return ar}function U(ar){var e=t(ar.charCodeAt(0));return parseInt(e,16)}function aj(e){var ar=U(e);if(ar>127){ar=ar-256}return ar}function Q(ar){var e=t(ar.charCodeAt(1));e+=t(ar.charCodeAt(0));return parseInt(e,16)}function P(e){var ar=Q(e);if(ar>32767){ar=ar-65536}return ar}function H(ar){var e=t(ar.charCodeAt(3));e+=t(ar.charCodeAt(2));e+=t(ar.charCodeAt(1));e+=t(ar.charCodeAt(0));return parseInt(e,16)}function S(e){var ar=H(e);if(ar>2147483647){ar=ar-4294967296}return ar}function aa(e,at){var ar=H(e);if(at===undefined){return ar}return(K(ar,at))}function n(e,at){var ar=new Date(H(e));ar=new Date(ar.getTime()+ar.getTimezoneOffset()*60000);if(at===undefined){return ar}return(ap(ar,at))}function ah(ar,at){var e=new Date(H(ar)*1000);e=new Date(e.getTime()+e.getTimezoneOffset()*60000);if(at===undefined){return e}return(ap(e,at))}function q(at){var av=1,ax=0.5,ar=H(at),e,aw,au;if(ar===0){return 0}e=((ar>>>31)===1)?"-":"+";ar<<=1;aw=(ar>>>24)-127;ar<<=8;for(au=1;au<=23;au++){av+=ar<0?ax:0;ar<<=1;ax/=2}return parseFloat(e+(av*Math.pow(2,aw)))}function G(at){var ar=H(at.substring(4,8)),aw=H(at.substring(0,4)),av=12,au=1,ay=0.5,e,ax;if(ar===0&&aw===0){return 0}e=((ar>>>31)===1)?"-":"+";ar<<=1;ax=(ar>>>21)-1023;ar<<=11;while(av<32){au+=ar<0?ay:0;ar<<=1;ay/=2;av++}if((aw>>>31)===1){au+=ay;aw<<=1;ay/=2}while(av<64){au+=aw<0?ay:0;aw<<=1;ay/=2;av++}return parseFloat(e+(au*Math.pow(2,ax)))}function af(e){return e.split(String.fromCharCode(0))[0]}function T(au){var av=p,ax=0,e="",aw,at,ar,aB,aA,az,ay;au=au.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aB=av[au.charAt(ax++)];aA=av[au.charAt(ax++)];az=av[au.charAt(ax++)];ay=av[au.charAt(ax++)];aw=(aB<<2)|(aA>>4);at=((aA&15)<<4)|(az>>2);ar=((az&3)<<6)|ay;e+=String.fromCharCode(aw);if(az!==64){e+=String.fromCharCode(at)}if(ay!==64){e+=String.fromCharCode(ar)}}while(ax<au.length);return e}function Y(ar,e,au){var at;switch(e){case"BOOL":at=(ar.charCodeAt(0)!="0");break;case"BYTE":case"USINT":at=U(ar);break;case"SINT":at=aj(ar);break;case"WORD":case"UINT":at=Q(ar);break;case"INT":case"INT16":at=P(ar);break;case"INT1DP":at=((P(ar))/10).toFixed(1);break;case"DWORD":case"UDINT":at=H(ar);break;case"DINT":at=S(ar);break;case"REAL":at=q(ar);if(au!==undefined){at=at.toFixed(parseInt(au,10))}break;case"LREAL":at=G(ar);if(au!==undefined){at=at.toFixed(parseInt(au,10))}break;case"STRING":at=af(ar);break;case"TOD":case"TIME_OF_DAY":at=n(ar,au);break;case"TIME":at=aa(ar,au);break;case"DT":case"DATE":case"DATE_AND_TIME":at=ah(ar,au);break;case"EndStruct":break;default:k("TAME library error: Unknown data type at parsing read request: "+e);break}return at}function x(aK){var ar,aC=aK.reqDescr.items,aA=[],aD=0,aH,au,av,aJ,ay,aF,az,aI,at,aE,aB,aw,ax;try{ar=aK.xmlHttpReq.responseXML.documentElement;au=T(ar.getElementsByTagName("ppData")[0].firstChild.data);for(aB=0,aw=aC.length;aB<aw;aB++){aH=aC[aB];aA=ak(aH);at=aA[0];aE=aA[1];aF=C[at];switch(at){case"STRING":if(aE!==undefined){ay=parseInt(aE,10)}aF=(ao(ay)?ay:aF)+1;break;case"EndStruct":aF=aH.val;break}az=aF<a?aF:a;if(aK.reqDescr.seq!==true){ax=j(aK.reqDescr);aD=aH.addr-ax}else{if(aK.reqDescr.calcAlignment===true&&az>1&&at!=="EndStruct"&&at!=="STRING"&&aD>0){aI=aD%az;if(aI>0){aD+=az-aI}}}av=au.substr(aD,aF);aJ=Y(av,at,aE);if(at!=="EndStruct"){B(aH.jvar,aJ,aK.reqDescr.dataObj,aH.prefix,aH.suffix)}if(aK.reqDescr.seq===true){aD+=aF}}}catch(aG){k("TAME library error: Parsing of Read Request failed:"+aG);k(aH);return}}function c(aR){var ar,aF=aR.reqDescr.items,aC=[],aJ=0,au=0,aH=window,aO=0,aN,aw,ax,aQ,aL,av,aK,aD,aA,ay,aG,aI,aB,az,aE;function at(){var aS,e;if(av==="STRING"){if(aK!==undefined){aS=parseInt(aK,10)}else{if(typeof aE.stringLength==="number"){aS=aE.stringLength}}aL=(ao(aS)?aS:aL)+1}e=ax.substr(au,aL);aQ=Y(e,av,aK);B(aG,aQ,aH,aN.prefix,aN.suffix);au+=aL}function aP(){var aT,aS,aX,aW,aU,aV;function e(){var aZ,aY;if(a>1&&av!=="STRING"&&av!=="EndStruct"){aZ=aL<a?aL:a;if(aZ>1&&au>0){aY=au%aZ;if(aY>0){au+=aZ-aY}}if(aZ>aO){aO=aZ}}}if(typeof aN.def==="string"){aN.def=B(aN.def)}else{if(ac.dataTypeTableReady===true&&aN.def===undefined){aN.def=h(aE.dataType)}else{if(typeof aN.def!=="object"){k("TAME library error: No structure defininition found!")}}}for(aV in aN.def){if(aN.def.hasOwnProperty(aV)){aS=aN.def[aV].split(".");if(aS[0]==="ARRAY"){aX=parseInt(aS[1],10);aW=aS.length-1;for(aT=0;aT<aX;aT++){av=aS[2];if(aS[aW]==="SP"){aG=aV+aT;if(aW>=4){aK=aS.slice(3,-1).join(".")}}else{aG=aV+"."+aT;if(aW>=3){aK=aS.slice(3).join(".")}}if(aI!==null){aG=aI+"."+aG}aL=C[av];e();at()}}else{if(aI!==null){aG=aI+"."+aV}else{aG=aV}av=aS[0];if(aS.length>2){aS[1]=aS.slice(1).join(".")}aK=aS[1];aL=C[av];e();at()}}}if(a>1&&aO>1&&av!=="STRING"&&av!=="EndStruct"){if(aO>a){aO=a}aU=au%aO;if(aU>0){au+=aO-aU}}}try{ar=aR.xmlHttpReq.responseXML.documentElement;aw=T(ar.getElementsByTagName("ppRdData")[0].firstChild.data);for(aD=0,aA=aF.length;aD<aA;aD++){ax=aw.substr(aJ,4);ay=Y(ax,"DWORD");if(ay!==0){k("TAME library error: ADS sub command error while processing a SumReadRequest!");k("Error code: "+ay);k(aF[aD])}aJ+=4}for(aD=0;aD<aA;aD++){aN=aF[aD];aE=am(aN);av=aE.type;aK=aE.format;az=aE.size;aI=null;ax=aw.substr(aJ,az);switch(av){case"ARRAY":aH=B(aN.jvar);au=0;aB=aE.arrayLength;if(aE.arrayDataType==="USER"){for(aI=0;aI<aB;aI++){aP()}}else{av=aE.arrayDataType;aL=C[av];for(aI=0;aI<aB;aI++){aG=aI;at()}}break;case"USER":aH=B(aN.jvar);au=0;aP();break;default:aH=window;aQ=Y(ax,av,aK);B(aN.jvar,aQ,aH,aN.prefix,aN.suffix)}aJ+=az}}catch(aM){k("TAME library error: Parsing of SumReadRequest failed:"+aM);k(aN);return}}function y(aL){var ar,aC=aL.reqDescr.items,aA=[],aE=0,at=0,aD=window,aI,av,aw,aK,aG,au,aF,aB,ay,ax,az,aJ;try{ar=aL.xmlHttpReq.responseXML.documentElement;av=T(ar.getElementsByTagName("ppRdData")[0].firstChild.data);for(aB=0,ay=aC.length;aB<ay;aB++){aw=av.substr(aE,4);ax=Y(aw,"DWORD");if(ax===0){if(aL.reqDescr.isRelHdlReq===true){aJ=aC[aB].toUpperCase();delete O[aJ];az=s.indexOf(aJ);delete s[az]}}else{k("TAME library error: ADS sub command error while processing a SumReadRequest!");k("Error code: "+ax);k(aC[aB])}aE+=4}if(aL.reqDescr.isRelHdlReq===true){for(aB=s.length-1;aB>=0;aB--){if(s[aB]===undefined){s.splice(aB,1)}}if(s.length===0){ac.handleCacheReady=false;k("TAME library info: All handles released.")}}}catch(aH){k("TAME library error: Parsing of SumWriteRequest failed:"+aH);k(aI);return}}function al(au){var ar;try{ar=au.xmlHttpReq.responseXML.documentElement;ac.adsState=parseInt(ar.getElementsByTagName("pAdsState")[0].firstChild.data,10);ac.adsStateTxt=V[ac.adsState];ac.deviceState=parseInt(ar.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(at){k("TAME library error: Parsing of ADS Read State Request failed:"+at);return}}function X(aB){var au,av=s,ar=0,e=0,aw,at,ax,aA,ay,az,aC;au=aB.xmlHttpReq.responseXML.documentElement;aw=T(au.getElementsByTagName("ppRdData")[0].firstChild.data);for(aA=0,ay=av.length;aA<ay;aA++){at=aw.substr(ar,4);az=Y(at,"DWORD");ar+=4;at=aw.substr(ar,4);aC=Y(at,"DWORD");ar+=4;if(az!==0){k("TAME library error: Error while reading a handle from the PLC!");k("Error code: "+az);k("Handle: "+av[aA]);throw"Handle request aborted!"}}for(aA=0;aA<ay;aA++){at=aw.substr(ar,4);ax=Y(at,"DWORD");ar+=4;O[av[aA]]=ax}ac.handleCacheReady=true;k("TAME library info: Handle cache ready.")}function N(ax,aw,au){var at={},av,e,ar;au.type=aw;ar=am(au);e=C[aw];switch(aw){case"STRING":if(ao(au.strlen)){aw+="."+au.strlen;e=au.strlen}else{if(typeof ar.stringLength==="number"){e=ar.stringLength;aw+="."+e}else{k("TAME library error: Could not get the length of the string for this request!");k(au)}}e++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof au.format==="string"){aw+="."+au.format}break;case"REAL":case"LREAL":if(typeof au.decPlaces==="number"){aw+="."+au.decPlaces}else{if(typeof au.dp==="number"){aw+="."+au.dp}}break}at={addr:au.addr,symbolName:ar.symbolName,dataTypeNames:ar.dataTypeNames,dataTypeArrIdx:ar.dataTypeArrIdx,symbolNameArrIdx:ar.symbolNameArrIdx,fullSymbolName:au.name,useHandle:au.handle,id:au.id,oc:au.oc,ocd:au.ocd,readLength:e,debug:au.debug,sync:au.sync,offs:au.offs,seq:true,items:[{val:au.val,jvar:au.jvar,type:aw,prefix:au.prefix,suffix:au.suffix}]};if(ax==="Write"){ac.writeReq(at)}else{ac.readReq(at)}}function I(au,av,at){var aw={},aI={},aC,ar,aK=0,aL=0,aJ=0,aM,e=[],aO,ay,aB=0,aD,az,aN=0,aE=0,aQ,aA,aP,aG,aF;aF=am(at);if(au==="Write"&&typeof at.val==="object"){aI=at.val}else{if(typeof at.jvar==="string"){aI=B(at.jvar)}else{k("TAME library error: No data object for this "+au+"-Request defined!")}}if(typeof at.arrlen==="number"){aC=at.arrlen}else{if(aF.arrayLength!==undefined){aC=aF.arrayLength}else{k("TAME library error: Can't get the array length for this request!");k(at)}}if(typeof at.item==="number"&&!isNaN(at.item)&&au==="Write"){aP=true;if(at.item<0||at.item>aC-1){k('TAME library error: Wrong value for "item"!');k("item: "+at.item);k("Last array index: "+(aC-1))}}function ax(){var aR;if(typeof at.def==="string"){at.def=B(at.def)}else{if(ac.dataTypeTableReady===true&&at.def===undefined){at.def=h(aF.dataType)}else{if(typeof at.def!=="object"){k("TAME library error: No structure definition found!")}}}for(aR in at.def){if(at.def.hasOwnProperty(aR)){e=at.def[aR].split(".");if(e[0]==="ARRAY"){aO=parseInt(e[1],10);e.shift();e.shift()}else{aO=1}for(aL=0;aL<aO;aL++){if(e[0]==="STRING"){if(typeof e[1]==="string"){aD=parseInt(e[1],10)}az=(ao(aD)?aD:C[e[0]])+1}else{az=C[e[0]]}if(a>1&&az>1&&e[0]!=="STRING"&&aB>0){aQ=aB%az;if(aQ>0){aB+=az-aQ}}aB+=az}if(a>1&&az>aN&&e[0]!=="STRING"){aN=az}}}if(a>1&&aN>1&&e[0]!=="STRING"){if(aN>a){aN=a}aQ=aB%aN;if(aQ>0){aE=aN-aQ;aB+=aE}}if(aP){ar=aB*at.item;aC=1}aw={addr:at.addr,symbolName:aF.symbolName,dataTypeNames:aF.dataTypeNames,fullSymbolName:at.name,addrOffset:ar,useHandle:at.handle,id:at.id,oc:at.oc,ocd:at.ocd,debug:at.debug,readLength:aB*aC,seq:true,calcAlignment:true,dataObj:aI,sync:at.sync,offs:at.offs,items:[]};for(aL=0;aL<aC;aL++){for(aR in at.def){if(at.def.hasOwnProperty(aR)){e=at.def[aR].split(".");if(e[0]==="ARRAY"){aO=parseInt(e[1],10);ay=e.length-1;for(aJ=0;aJ<aO;aJ++){if(e[ay]==="SP"){aw.items[aK]={jvar:aL+"."+aR+aJ};if(ay===4){aw.items[aK].type=e[2]+"."+e[3]}else{aw.items[aK].type=e[2]}}else{aw.items[aK]={jvar:aL+"."+aR+"."+aJ};if(ay===3){aw.items[aK].type=e[2]+"."+e[3]}else{aw.items[aK].type=e[2]}}if(au==="Write"){if(aP){if(e[ay]==="SP"){aw.items[aK].val=aI[at.item][aR+aJ]}else{aw.items[aK].val=aI[at.item][aR][aJ]}}else{if(e[ay]==="SP"){aw.items[aK].val=aI[aL][aR+aJ]}else{aw.items[aK].val=aI[aL][aR][aJ]}}}aK++}}else{aw.items[aK]={jvar:aL+"."+aR,type:at.def[aR]};if(au==="Write"){if(aP){aw.items[aK].val=aI[at.item][aR]}else{aw.items[aK].val=aI[aL][aR]}}aK++}}}if(a>1){aw.items[aK]={type:"EndStruct",val:aE};aK++}}}function aH(){aM=C[av];switch(av){case"STRING":if(ao(at.strlen)){av+="."+at.strlen;aM=at.strlen}else{if(typeof aF.stringLength==="number"){aM=aF.stringLength;av+="."+aM}else{k("TAME library error: Could not get the length of the string for this request!");k(at)}}aM++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof at.format==="string"){av+="."+at.format}break;case"REAL":case"LREAL":if(typeof at.decPlaces==="number"){av+="."+at.decPlaces}else{if(typeof at.dp==="number"){av+="."+at.dp}}break}if(aP){ar=at.item*aM;aC=1}aw={addr:at.addr,symbolName:aF.symbolName,dataTypeNames:aF.dataTypeNames,dataTypeArrIdx:aF.dataTypeArrIdx,symbolNameArrIdx:aF.symbolNameArrIdx,fullSymbolName:at.name,useHandle:at.handle,addrOffset:ar,id:at.id,oc:at.oc,ocd:at.ocd,readLength:aM*aC,debug:at.debug,seq:true,dataObj:aI,items:[]};for(aL=0;aL<aC;aL++){aw.items[aL]={jvar:aL,type:av};if(au==="Write"){if(aP){aw.items[aL].val=aI[at.item]}else{aw.items[aL].val=aI[aL]}}}}if(av==="STRUCT"){ax()}else{aH()}if(au==="Write"){ac.writeReq(aw)}else{ac.readReq(aw)}}function ae(e,aA){var ax={},ar={},aB=[],av=0,az,au,aw,ay,at;at=am(aA);if(e==="Write"&&typeof aA.val==="object"){ar=aA.val}else{if(typeof aA.jvar==="string"){ar=B(aA.jvar)}else{k("TAME library error: No data object for this "+e+"-Request defined!")}}if(typeof aA.def==="string"){aA.def=B(aA.def)}else{if(ac.dataTypeTableReady===true&&aA.def===undefined){aA.def=h(at.dataType)}else{if(typeof aA.def!=="object"){k("TAME library error: No structure defininition found!")}}}ax={addr:aA.addr,symbolName:at.symbolName,dataTypeNames:at.dataTypeNames,dataTypeArrIdx:at.dataTypeArrIdx,symbolNameArrIdx:at.symbolNameArrIdx,fullSymbolName:aA.name,useHandle:aA.handle,id:aA.id,oc:aA.oc,ocd:aA.ocd,debug:aA.debug,seq:true,calcAlignment:true,dataObj:ar,sync:aA.sync,offs:aA.offs,items:[]};for(aw in aA.def){if(aA.def.hasOwnProperty(aw)){aB=aA.def[aw].split(".");if(aB[0]==="ARRAY"){au=parseInt(aB[1],10);az=aB.length-1;for(ay=0;ay<au;ay++){if(aB[az]==="SP"){ax.items[av]={jvar:aw+ay};if(az===4){ax.items[av].type=aB[2]+"."+aB[3]}else{ax.items[av].type=aB[2]}}else{ax.items[av]={jvar:aw+"."+ay};if(az===3){ax.items[av].type=aB[2]+"."+aB[3]}else{ax.items[av].type=aB[2]}}if(e==="Write"){if(aB[az]==="SP"){ax.items[av].val=ar[aw+ay]}else{ax.items[av].val=ar[aw][ay]}}av++}}else{ax.items[av]={jvar:aw,type:aA.def[aw]};if(e==="Write"){ax.items[av].val=ar[aw]}av++}}}if(e==="Write"){ac.writeReq(ax)}else{ac.readReq(ax)}}this.writeReq=function(au){var aw=au.items,aD={},e=[],az=[],aG=[],ay,aC,at,ax,ar,aE,aA,aF,av,aB;if(typeof au.name==="string"){au.name=au.name.toUpperCase()}for(aB=0,at=aw.length;aB<at;aB++){aF=aw[aB];az=ak(aF);ay=az[0];aC=az[1];if(isNaN(C[ay])){k("TAME library error: Could not get the length of the data type: "+ay);k("TAME library error: Probably wrong type definition. Please check the manual.");k(au);return}ax=(C[ay]<a)?C[ay]:a;if(au.calcAlignment===true&&ax>1&&ay!=="STRING"&&ay!=="EndStruct"&&e.length>0){aA=e.length%ax;if(aA>0){aE=ax-aA;for(av=1;av<=aE;av++){e.push(0)}}}if(ay==="EndStruct"){for(av=1;av<=aF.val;av++){e.push(0)}}else{aG=d(aF,ay,aC,C[ay]);e=e.concat(aG)}}if(e&&e.length>0){e=o(e)}aD={method:"Write",indexGroup:z(au),indexOffset:j(au),pData:e,reqDescr:au};v(aD).send()};this.readReq=function(at){var aB={},au=at.items,aw=[],aC,aA,av,e,ax,ay,aD,az,ar;if(typeof at.readLength!=="number"){at.readLength=0;for(az=0,e=au.length;az<e;az++){aC=au[az];aw=ak(aC);av=aw[0];aA=aw[1];if(isNaN(C[av])){k("TAME library error: Could not get the length of the data type: "+av);k("TAME library error: Probably wrong type definition. Please check the manual.");k(at);return}if(av==="STRING"){if(typeof aA==="string"){aD=parseInt(aA,10)}ay=(ao(aD)?aD:C[av])+1}else{ay=C[av]}if(at.seq===true){if(at.calcAlignment===true&&ay>1&&av!=="EndStruct"&&av!=="STRING"&&at.readLength>0){ax=at.readLength%ay;if(ax>0){at.readLength+=ay-ax}}at.readLength+=ay}else{ar=j(at);at.readLength=ay+aC.addr-ar}}}aB={method:"Read",indexGroup:z(at),indexOffset:j(at),reqDescr:at};v(aB).send()};this.sumReadReq=function(au){var aC={},aw=au.items,az=[],aE=[],aF=[],at=aw.length,av={},ay,aB,aD,aA,ax,e,ar;au.readLength=at*4;for(aA=0;aA<at;aA++){aD=aw[aA];ar=am(aD);ax=ar.size;au.readLength+=ax;av.val=z(ar);aF=d(av,"UDINT",aB,4);aE=aE.concat(aF);av.val=j(ar);aF=d(av,"UDINT",aB,4);aE=aE.concat(aF);av.val=ax;aF=d(av,"UDINT",aB,4);aE=aE.concat(aF)}if(aE.length>0){e=o(aE)}aC={method:"ReadWrite",indexGroup:l.SumRd,indexOffset:aw.length,pwrData:e,reqDescr:au};v(aC).send()};this.sumWriteReq=function(au){var aN={},aB=au.items,ax=[],ar=[],az=[],av=aB.length,aK={},aI=0,at,aF,aH,ay,aG,aM,aE,aD,aw,aJ,e,aA;function aC(){var aO;aG=C[at];if(at==="STRING"){if(aF!==undefined){aO=parseInt(aF,10)}else{if(typeof aA.stringLength==="number"){aO=aA.stringLength}}aF=(ao(aO)?aO:aG)}}function aL(){var aR,aW,aO,aS,aU,aP,aQ=[];function aV(){var aY,aX;if(a>1&&at!=="STRING"&&at!=="EndStruct"){aY=aG<a?aG:a;if(aY>1&&aQ.length>0){aU=aQ.length%aY;if(aU>0){e=aY-aU;for(aX=1;aX<=e;aX++){aQ.push(0)}}}if(aY>aI){aI=aY}}}if(typeof aH.def==="string"){aH.def=B(aH.def)}else{if(ac.dataTypeTableReady===true&&aH.def===undefined){aH.def=h(aA.dataType)}else{if(typeof aH.def!=="object"){k("TAME library error: No structure defininition found!")}}}for(aP in aH.def){if(aH.def.hasOwnProperty(aP)){try{aW=aH.def[aP].split(".");if(aW[0]==="ARRAY"){aO=parseInt(aW[1],10);aS=aW.length-1;for(aR=0;aR<aO;aR++){at=aW[2];if(aW[aS]==="SP"){if(aS>=4){aF=aW.slice(3,-1).join(".")}}else{if(aS>=3){aF=aW.slice(3).join(".")}}if(aE!==null){if(aW[aS]==="SP"){aK.val=aH.val[aE][aP+aR]}else{aK.val=aH.val[aE][aP][aR]}}else{aK.val=aH.val[aP][aR]}aC();aV();az=d(aK,at,aF,aG);aQ=aQ.concat(az)}}else{if(aE!==null){aK.val=aH.val[aE][aP]}else{aK.val=aH.val[aP]}at=aW[0];if(aW.length>2){aW[1]=aW.slice(1).join(".")}aF=aW[1];aC();aV();az=d(aK,at,aF,aG);aQ=aQ.concat(az)}}catch(aT){k("TAME library error: Could not set values for a structure in SumWriteReq: "+aT);k(aH)}}}if(a>1&&aI>1&&aW[0]!=="STRING"&&aW[0]!=="EndStruct"){aU=aQ.length%aI;if(aU>0){e=aI-aU;for(aD=1;aD<=e;aD++){aQ.push(0)}}}ar=ar.concat(aQ)}au.readLength=av*4;for(ay=0;ay<av;ay++){aH=aB[ay];aA=am(aH);at=aA.type;aF=aA.format;aG=aA.size;aK.val=z(aA);az=d(aK,"UDINT",aF,4);ar=ar.concat(az);aK.val=j(aA);az=d(aK,"UDINT",aF,4);ar=ar.concat(az);aK.val=aG;az=d(aK,"UDINT",aF,4);ar=ar.concat(az)}for(ay=0;ay<av;ay++){aH=aB[ay];aA=am(aH);at=aA.type;aF=aA.format;aG=aA.size;aE=null;switch(at){case"ARRAY":aw=parseInt(aA.arrayLength,10);if(aw!==aH.val.length){k("TAME library error: Array length in JS differs from the length in the PLC!");k("Length in JS: "+aH.val.length);k("Length in PLC: "+aw);k(aH);return}if(aA.arrayDataType==="USER"){for(aE=0;aE<aw;aE++){aL()}}else{at=aA.arrayDataType;if(at==="STRING"){aF=aA.stringLength}else{aG=aA.itemSize}for(aE=0;aE<aw;aE++){aK.val=aH.val[aE];az=d(aK,at,aF,aG);ar=ar.concat(az)}}break;case"USER":aL();break;default:if(at==="STRING"){aF=aA.stringLength}else{aG=aA.size}az=d(aH,at,aF,aG);ar=ar.concat(az)}}if(ar.length>0){aM=o(ar)}aN={method:"ReadWrite",indexGroup:l.SumWr,indexOffset:aB.length,pwrData:aM,reqDescr:au};v(aN).send()};this.readAdsState=function(e){var ar={method:"ReadState",reqDescr:e};v(ar).send()};this.logHandleCache=function(){k(O)};this.logSymbols=function(){k(R)};this.logDataTypes=function(){k(aq)};this.getSymbolsAsJSON=function(){var at;if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{at=JSON.stringify(R);return at}catch(ar){k("TAME library error: Could not convert the Symbol Table to JSON:"+ar)}}};this.setSymbolsFromJSON=function(at){if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{R=JSON.parse(at)}catch(ar){k("TAME library error: Could not create the Symbol Table from JSON:"+ar);return}ac.symTableReady=true;k("TAME library info: Symbol Table successfully created from JSON data.")}};this.getDataTypesAsJSON=function(){var at;if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{at=JSON.stringify(aq);return at}catch(ar){k("TAME library error: Could not convert the Data Type Table to JSON:"+ar)}}};this.setDataTypesFromJSON=function(at){if(typeof JSON!=="object"){k("TAME library error: No JSON parser found.")}else{try{aq=JSON.parse(at)}catch(ar){k("TAME library error: Could not create the Data Type Table from JSON:"+ar);return}ac.dataTypeTableReady=true;k("TAME library info: Data Type Table successfully created from JSON data.")}};this.parseResponse=function(ax){var at,aw,ar;if(typeof ax.reqDescr.id==="number"){F[ax.reqDescr.id]=0}if(ax.xmlHttpReq.responseXML===null){k('TAME library error: Request contains no XML data. Object "responseXML" is null.');k('TAME library error: This is the "responseText":');k(ax.xmlHttpReq.responseText)}try{at=ax.xmlHttpReq.responseXML.documentElement}catch(av){k("TAME library error: No XML data in server response:"+av);return}try{ar=at.getElementsByTagName("faultstring")[0].firstChild.data;try{aw=at.getElementsByTagName("errorcode")[0].firstChild.data}catch(av){aw="-"}k("TAME library error: Message from server:  "+ar+" ("+aw+")");return}catch(au){aw=0}if(typeof at.normalize==="function"){at.normalize()}if(ax.method==="ReadState"){al(ax)}else{if(ax.method==="Read"||ax.method==="ReadWrite"){switch(ax.indexGroup){case l.UploadInfo:Z(ax);break;case l.Upload:ag(ax);break;case l.SumRd:c(ax);break;case l.SumWr:y(ax);break;case l.SumRdWr:X(ax);break;default:x(ax)}}}if(typeof ax.reqDescr.oc==="function"){if(typeof ax.reqDescr.ocd==="number"){window.setTimeout(ax.reqDescr.oc,ax.reqDescr.ocd)}else{ax.reqDescr.oc()}}};this.getHandles=function(at){var az={},aA=[],aw=at.symbols.length,aB,ay,av,e,ax,ar,au;at.readLength=aw*12;for(ay=0;ay<aw;ay++){aB=ai(l.HandleByName,4);aA=aA.concat(aB);aB=ai(0,4);aA=aA.concat(aB);aB=ai(4,4);aA=aA.concat(aB);aB=ai(at.symbols[ay].length,4);aA=aA.concat(aB)}for(ay=0;ay<aw;ay++){ar=at.symbols[ay].toUpperCase();s[ay]=ar;aB=[];for(au=0;au<ar.length;au++){aB[au]=ar.charCodeAt(au)}aA=aA.concat(aB)}if(aA.length>0){e=o(aA)}az={method:"ReadWrite",indexGroup:l.SumRdWr,indexOffset:aw,pwrData:e,reqDescr:at};v(az).send()};this.releaseHandles=function(ar){var ax={},ay=[],az=[],au=0,av=[],at=0,aw,e;if(ar===undefined){ar={}}else{if(ar.symbols!==undefined){au=ar.symbols.length;for(aw=0;aw<au;aw++){av[aw]=ar.symbols[aw].toUpperCase()}}else{au=s.length;av=s}}ar.readLength=au*4;for(aw=0;aw<au;aw++){az=ai(l.ReleaseHandle,4);ay=ay.concat(az);az=ai(0,4);ay=ay.concat(az);az=ai(4,4);ay=ay.concat(az)}for(aw=0;aw<au;aw++){if(typeof O[av[aw]]==="number"){az=ai(O[av[aw]],4);ay=ay.concat(az)}else{k("TAME library error: Handle for symbol name "+av[aw]+" does not exist in handle cache!");throw"Releasing Handles aborted!"}}if(ay.length>0){e=o(ay)}ar.items=av;ar.isRelHdlReq=true;ax={method:"ReadWrite",indexGroup:l.SumWr,indexOffset:au,pwrData:e,reqDescr:ar};v(ax).send()};this.writeBool=function(e){N("Write","BOOL",e)};this.writeByte=function(e){N("Write","BYTE",e)};this.writeUsint=function(e){N("Write","USINT",e)};this.writeSint=function(e){N("Write","SINT",e)};this.writeWord=function(e){N("Write","WORD",e)};this.writeUint=function(e){N("Write","UINT",e)};this.writeInt=function(e){N("Write","INT",e)};this.writeInt1Dp=function(e){N("Write","INT1DP",e)};this.writeDword=function(e){N("Write","DWORD",e)};this.writeUdint=function(e){N("Write","UDINT",e)};this.writeDint=function(e){N("Write","DINT",e)};this.writeReal=function(e){N("Write","REAL",e)};this.writeLreal=function(e){N("Write","LREAL",e)};this.writeString=function(e){N("Write","STRING",e)};this.writeTime=function(e){N("Write","TIME",e)};this.writeTod=function(e){N("Write","TOD",e)};this.writeDate=function(e){N("Write","DATE",e)};this.writeDt=function(e){N("Write","DT",e)};this.readBool=function(e){N("Read","BOOL",e)};this.readByte=function(e){N("Read","BYTE",e)};this.readUsint=function(e){N("Read","USINT",e)};this.readSint=function(e){N("Read","SINT",e)};this.readWord=function(e){N("Read","WORD",e)};this.readUint=function(e){N("Read","UINT",e)};this.readInt=function(e){N("Read","INT",e)};this.readInt1Dp=function(e){N("Read","INT1DP",e)};this.readDword=function(e){N("Read","DWORD",e)};this.readUdint=function(e){N("Read","UDINT",e)};this.readDint=function(e){N("Read","DINT",e)};this.readReal=function(e){N("Read","REAL",e)};this.readLreal=function(e){N("Read","LREAL",e)};this.readString=function(e){N("Read","STRING",e)};this.readTime=function(e){N("Read","TIME",e)};this.readTod=function(e){N("Read","TOD",e)};this.readDate=function(e){N("Read","DATE",e)};this.readDt=function(e){N("Read","DT",e)};this.writeStruct=function(e){ae("Write",e)};this.readStruct=function(e){ae("Read",e)};this.writeArrayOfBool=function(e){I("Write","BOOL",e)};this.writeArrayOfByte=function(e){I("Write","BYTE",e)};this.writeArrayOfUsint=function(e){I("Write","USINT",e)};this.writeArrayOfSint=function(e){I("Write","SINT",e)};this.writeArrayOfWord=function(e){I("Write","WORD",e)};this.writeArrayOfUint=function(e){I("Write","UINT",e)};this.writeArrayOfInt=function(e){I("Write","INT",e)};this.writeArrayOfInt1Dp=function(e){I("Write","INT1DP",e)};this.writeArrayOfDword=function(e){I("Write","DWORD",e)};this.writeArrayOfUdint=function(e){I("Write","UDINT",e)};this.writeArrayOfDint=function(e){I("Write","DINT",e)};this.writeArrayOfReal=function(e){I("Write","REAL",e)};this.writeArrayOfLreal=function(e){I("Write","LREAL",e)};this.writeArrayOfString=function(e){I("Write","STRING",e)};this.writeArrayOfTime=function(e){I("Write","TIME",e)};this.writeArrayOfTod=function(e){I("Write","TOD",e)};this.writeArrayOfDate=function(e){I("Write","DATE",e)};this.writeArrayOfDt=function(e){I("Write","DT",e)};this.writeArrayOfStruct=function(e){I("Write","STRUCT",e)};this.readArrayOfBool=function(e){I("Read","BOOL",e)};this.readArrayOfByte=function(e){I("Read","BYTE",e)};this.readArrayOfUsint=function(e){I("Read","USINT",e)};this.readArrayOfSint=function(e){I("Read","SINT",e)};this.readArrayOfWord=function(e){I("Read","WORD",e)};this.readArrayOfUint=function(e){I("Read","UINT",e)};this.readArrayOfInt=function(e){I("Read","INT",e)};this.readArrayOfInt1Dp=function(e){I("Read","INT1DP",e)};this.readArrayOfDword=function(e){I("Read","DWORD",e)};this.readArrayOfUdint=function(e){I("Read","UDINT",e)};this.readArrayOfDint=function(e){I("Read","DINT",e)};this.readArrayOfReal=function(e){I("Read","REAL",e)};this.readArrayOfLreal=function(e){I("Read","LREAL",e)};this.readArrayOfString=function(e){I("Read","STRING",e)};this.readArrayOfTime=function(e){I("Read","TIME",e)};this.readArrayOfTod=function(e){I("Read","TOD",e)};this.readArrayOfDate=function(e){I("Read","DATE",e)};this.readArrayOfDt=function(e){I("Read","DT",e)};this.readArrayOfStruct=function(e){I("Read","STRUCT",e)};function ad(){var e={method:"Read",sync:true,indexGroup:l.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};v(e).send()}function Z(ax){var ar,at,ay,av,au;try{ar=ax.xmlHttpReq.responseXML.documentElement;at=T(ar.getElementsByTagName("ppData")[0].firstChild.data);ay=at.substr(0,4);b=Y(ay,"DWORD");ay=at.substr(4,4);w=Y(ay,"DWORD")}catch(aw){k("TAME library error: Parsing of UploadInfo failed:"+aw);return}au={method:"Read",sync:true,indexGroup:l.Upload,indexOffset:0,reqDescr:{readLength:w}};v(au).send()}function ag(aJ){var ar,aB=0,aG=4,aD=8,az=12,aw=30,av,ax,aI,aA,aC,at,aH,ay,au,aF;try{ar=aJ.xmlHttpReq.responseXML.documentElement;av=T(ar.getElementsByTagName("ppData")[0].firstChild.data);for(aA=0;aA<b;aA++){ax=av.substr(aB,4);aC=Y(ax,"DWORD");at=av.substring(aB+aw,(aB+aC)).split(String.fromCharCode(0));name=at[0].toUpperCase();R[name]={typeString:at[1],indexGroup:Y(av.substr(aB+aG,4),"DWORD"),indexOffset:Y(av.substr(aB+aD,4),"DWORD"),size:Y(av.substr(aB+az,4),"DWORD")};aH=at[1].split(" ");if(aH[0]==="ARRAY"){R[name].type=aH[0];ay=aH[1].substring(1,aH[1].length-1);ay=ay.split("..");R[name].arrStartIdx=parseInt(ay[0],10);ay=parseInt(ay[1],10)-parseInt(ay[0],10)+1;R[name].arrayLength=ay;au=aH[3].split("(");if(au[1]!==undefined){au[1]=au[1].substr(0,au[1].length-1);R[name].fullType=aH[0]+"."+ay+"."+au[0]+"."+au[1];R[name].stringLength=parseInt(au[1],10)}else{R[name].fullType=aH[0]+"."+ay+"."+au[0]}R[name].itemSize=R[name].size/ay;R[name].arrayDataType="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(au[0]===aF){R[name].arrayDataType=au[0]}}}if(R[name].arrayDataType==="USER"){R[name].dataType=au[0]}}else{au=aH[0].split("(");if(au[1]!==undefined){au[1]=au[1].substr(0,au[1].length-1);R[name].fullType=au[0]+"."+au[1];R[name].stringLength=parseInt(au[1],10)}else{R[name].fullType=au[0]}R[name].type="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(au[0]===aF){R[name].type=au[0]}}}if(R[name].type==="USER"){R[name].dataType=au[0]}}aB+=aC}ac.symTableReady=true;k("TAME library info: End of fetching the symbols.");k("TAME library info: Symbol table ready.")}catch(aE){k("TAME library error: Parsing of uploaded symbol information failed:"+aE);return}}function J(){var az=ab(),ay=[],aD,aJ,aA,aH,aw,ar,aF,ax;az.open("GET",f.configFileUrl,false);az.setRequestHeader("Content-Type","text/xml");az.send(null);k("TAME library info: Start reading the TPY file.");if(typeof DOMParser=="function"){try{aD=(new DOMParser()).parseFromString(az.responseText,"text/xml")}catch(aE){k("TAME library error: Creating a DOM object from TPY failed:"+aE);return}}else{k("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(typeof f.amsNetId!=="string"||typeof f.amsPort!=="string"||a===0){k("TAME library info: Start reading the service information from the TPY file.");try{A={netId:aD.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:aD.getElementsByTagName("Port")[0].childNodes[0].nodeValue};ax=aD.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(ax==="2"){A.alignment=parseInt(aD.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(ax==="3"){A.alignment=8}else{k("TAME library error: Could not determine the TwinCAT version.")}}k("TAME library info: End of reading the service information from the TPY file.")}catch(aE){k("TAME library error: An error occured while reading service information from the TPY file:");k(aE)}}else{k("TAME library info: NetId, port and alignment manually set. Skip reading the service information from the TPY file.")}if(f.forceUploadUsage!==true){k("TAME library info: Start reading the symbols from the TPY file.");try{aA=aD.getElementsByTagName("Symbols")[0];ay=aA.getElementsByTagName("Symbol");for(var aC=0;aC<ay.length;aC++){aJ=ay[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();R[aJ]={typeString:ay[aC].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(ay[aC].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(ay[aC].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(ay[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};R[aJ].size=(R[aJ].bitSize>=8)?R[aJ].bitSize/8:R[aJ].bitSize;aH=R[aJ].typeString.split(" ");if(aH[0]==="ARRAY"){R[aJ].type=aH[0];aw=aH[1].substring(1,aH[1].length-1);aw=aw.split("..");R[aJ].arrStartIdx=parseInt(aw[0],10);aw=parseInt(aw[1],10)-parseInt(aw[0],10)+1;R[aJ].arrayLength=aw;ar=aH[3].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);R[aJ].fullType=aH[0]+"."+aw+"."+ar[0]+"."+ar[1];R[aJ].stringLength=parseInt(ar[1],10)}else{R[aJ].fullType=aH[0]+"."+aw+"."+ar[0]}R[aJ].itemSize=R[aJ].size/aw;R[aJ].arrayDataType="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(ar[0]===aF){R[aJ].arrayDataType=ar[0]}}}if(R[aJ].arrayDataType==="USER"){R[aJ].dataType=ar[0]}}else{ar=aH[0].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);R[aJ].fullType=ar[0]+"."+ar[1];R[aJ].stringLength=parseInt(ar[1],10)}else{R[aJ].fullType=ar[0]}R[aJ].type="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(ar[0]===aF){R[aJ].type=ar[0]}}}if(R[aJ].type==="USER"){R[aJ].dataType=ar[0]}}}ac.symTableReady=true;k("TAME library info: End of reading the symbols from the TPY file.");k("TAME library info: Symbol table ready.")}catch(aE){k("TAME library error: An error occured while parsing the symbol file:");k(aE)}}else{k("TAME library info: Reading the symbols from the TPY file is deactivated.")}var av,aG,at,au,aI;if(true){k("TAME library info: Start reading the data types from the TPY file.");try{av=aD.getElementsByTagName("DataTypes")[0];aG=av.getElementsByTagName("DataType");for(var aC=0;aC<aG.length;aC++){aI=aG[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aJ=aI.split(" ")[0];if(aJ==="ARRAY"){aq[aI]={bitSize:parseInt(aG[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};aq[aI].size=aq[aI].bitSize/8}}for(var aC=0;aC<aG.length;aC++){aI=aG[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aJ=aI.split(" ")[0];if(aJ!=="ARRAY"){aq[aJ]={bitSize:parseInt(aG[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};aq[aJ].size=aq[aJ].bitSize/8;at=aG[aC].getElementsByTagName("SubItem");for(var aB=0;aB<at.length;aB++){au=at[aB].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aq[aJ].subItems[au]={typeString:at[aB].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:at[aB].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(at[aB].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(at[aB].getElementsByTagName("BitOffs")[0]!==undefined){aq[aJ].subItems[au].bitOffset=parseInt(at[aB].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}aq[aJ].subItems[au].size=(aq[aJ].subItems[au].bitSize>=8)?aq[aJ].subItems[au].bitSize/8:aq[aJ].subItems[au].bitSize;aH=aq[aJ].subItems[au].typeString.split(" ");if(aH[0]==="ARRAY"){aq[aJ].subItems[au].type=aH[0];aw=aH[1].substring(1,aH[1].length-1);aw=aw.split("..");aq[aJ].subItems[au].arrStartIdx=parseInt(aw[0],10);aw=parseInt(aw[1],10)-parseInt(aw[0],10)+1;aq[aJ].subItems[au].arrayLength=aw;ar=aH[3].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);aq[aJ].subItems[au].fullType=aH[0]+"."+aw+"."+ar[0]+"."+ar[1];aq[aJ].subItems[au].stringLength=parseInt(ar[1],10)}else{aq[aJ].subItems[au].fullType=aH[0]+"."+aw+"."+ar[0]}aq[aJ].subItems[au].bitSize=aq[aq[aJ].subItems[au].typeString].bitSize;aq[aJ].subItems[au].size=aq[aq[aJ].subItems[au].typeString].size;aq[aJ].subItems[au].itemSize=aq[aJ].subItems[au].size/aw;aq[aJ].subItems[au].arrayDataType="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(ar[0]===aF){aq[aJ].subItems[au].arrayDataType=ar[0]}}}if(aq[aJ].subItems[au].arrayDataType==="USER"){aq[aJ].subItems[au].dataType=ar[0]}}else{ar=aH[0].split("(");if(ar[1]!==undefined){ar[1]=ar[1].substr(0,ar[1].length-1);aq[aJ].subItems[au].fullType=ar[0]+"."+ar[1];aq[aJ].subItems[au].stringLength=parseInt(ar[1],10)}else{aq[aJ].subItems[au].fullType=ar[0]}aq[aJ].subItems[au].type="USER";for(aF in C){if(C.hasOwnProperty(aF)){if(ar[0]===aF){aq[aJ].subItems[au].type=ar[0]}}}if(aq[aJ].subItems[au].type==="USER"){aq[aJ].subItems[au].dataType=ar[0]}}}}}ac.dataTypeTableReady=true;k("TAME library info: End of reading the data types from the TPY file.");k("TAME library info: Data type table ready.")}catch(aE){k("TAME library error: An error occured while creating the data type information:");k("Type: "+aI);k("SubItem: "+au);k(aE)}}}function u(){if(typeof f.amsNetId!=="string"){f.amsNetId=A.netId;k("TAME library info: No NetId definition found. NetId from TPY file is used.")}if(typeof f.amsPort!=="string"){f.amsPort=A.port;k("TAME library info: No AMS port definition found. Port number from TPY file is used.")}if(a===0){if(A.alignment!==undefined){a=A.alignment;k("TAME library info: No alignment parameter found. Alignment from TPY file is used.")}else{a=1;k("TAME library warning: Can't get a value for the data aligment. Default value for alignment is used (1). This works only with TC2 and x86 processors.")}}if(a!==1&&a!==4&&a!==8){k("TAME library warning: The value for the alignment should be 1, 4 or 8.")}k("TAME library info: Target information: NetId: "+f.amsNetId+", AMS port: "+f.amsPort+" , alignment: "+a)}if(f.dontFetchSymbols===true){k("TAME library warning: Reading of the UploadInfo and the TPY file deactivated. Symbol Table could not be created.");if(a!==1&&a!==4&&a!==8){k("TAME library warning: The value for the alignment should be 1, 4 or 8.")}k("TAME library info: Target information: NetId: "+f.amsNetId+", AMS port: "+f.amsPort+" , alignment: "+a)}else{if(typeof f.configFileUrl=="string"){k("TAME library info: Fetching the TPY file from the webserver.");J()}u();if(typeof f.configFileUrl!="string"||f.forceUploadUsage===true){k("TAME library info: Start fetching the symbols from PLC.");try{ad()}catch(an){k("TAME library error: Could'nt fetch the symbol information from the PLC:"+an);return}}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};