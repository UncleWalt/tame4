/*!
 * TAME [TwinCAT ADS Made Easy] V4.0 alpha 151231
 * 
 * Copyright (c) 2009-2015 Thomas Schmidt; t.schmidt.p1 at freenet.de
 * 
 * Dual licensed under:
 *  MIT - http://www.opensource.org/licenses/mit-license
 *  GPLv3 - http://www.opensource.org/licenses/GPL-3.0
 * 
 */
var TAME={version:"V4.0 alpha 151231",weekdShortNames:{ge:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},weekdLongNames:{ge:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},monthsShortNames:{ge:["Jan","Feb","Mrz","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],en:["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dez"]},monthsLongNames:{ge:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]}};TAME.WebServiceClient=function(e){function j(aq){try{window.console.log(aq)}catch(ar){alert(aq)}}var ac=this,k={M:16416,MX:16417,DB:16448,I:61472,IX:61473,Q:61488,QX:61489,Upload:61451,UploadInfo:61452,HandleByName:61443,ValueByHandle:61445,ReleaseHandle:61446,SumRd:61568,SumWr:61569,SumRdWr:61570},C={BOOL:1,BYTE:1,USINT:1,SINT:1,WORD:2,UINT:2,INT:2,INT16:2,INT1DP:2,DWORD:4,UDINT:4,DINT:4,TIME:4,TOD:4,TIME_OF_DAY:4,DATE:4,DT:4,DATE_AND_TIME:4,POINTER:4,REAL:4,LREAL:8,STRING:80,EndStruct:0},V=["INVALID","IDLE","RESET","INIT","START","RUN","STOP","SAVECFG","POWERGOOD","ERROR","SHUTDOWN","SUSPEND","RESUME","CONFIG","RECONFIG"],f=(typeof e.language==="string")?e.language:"ge",l=(function(){var aq={},at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ar;for(ar=0;ar<at.length;ar++){aq[ar]=at.charAt(ar)}return aq}()),o=(function(){var aq={},at="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ar;for(ar=0;ar<at.length;ar++){aq[at.charAt(ar)]=ar}return aq}()),a=0,F=[0],R={},ap={},A={},b=0,v=0,O={},r=[];j("TAME library version: "+TAME.version);if(typeof e.serviceUrl!=="string"){j("TAME library error: Service URL is not a string!");return}if(typeof e.amsNetId!=="string"&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){j("TAME library error: NetId is not defined and there is no URL for fetching the TPY file or fetching the symbols is deactivated!");return}if(e.amsPort===undefined&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){e.amsPort="801";j("TAME library warning: AMS port number is not set! Default port 801 will be used.")}else{if(typeof e.amsPort==="number"){j("TAME library warning: AMS port number is not a string! Trying to convert it.");e.amsPort=e.amsPort.toString(10)}}if(parseInt(e.amsPort,10)<801||parseInt(e.amsPort,10)>891){j("TAME library error: AMS Port Number ("+parseInt(e.amsPort,10)+") is out of range (801-891)!");return}if(e.dataAlign4===true){a=4}else{if(e.alignment===undefined&&(typeof e.configFileUrl!=="string"||e.dontFetchSymbols===true)){a=1}else{if(typeof e.alignment==="string"){a=parseInt(e.alignment,10)}else{if(typeof e.alignment==="number"){a=e.alignment}}}}if(e.syncXmlHttp===true){j('TAME library info: The "syncXmlHttp" parameter was set. Synchronous XMLHttpRequests will be used by default.')}if(typeof e.serviceUser==="string"&&typeof e.servicePassword==="string"){j("TAME library info: Username and password set. Authenticated requests will be used.")}else{e.serviceUser=null;e.servicePassword=null}if(e.useHandles===true){j('TAME library info: The "useHandles" parameter was set. Handles will be used for all requests.')}this.dateNames={weekdShort:TAME.weekdShortNames[f],weekdLong:TAME.weekdLongNames[f],monthsShort:TAME.monthsShortNames[f],monthsLong:TAME.monthsLongNames[f]};this.maxStringLen=255;this.maxDropReq=10;this.useCheckBounds=true;this.adsState=null;this.adsStateTxt="";this.deviceState=null;this.symTableReady=false;this.dataTypeTableReady=false;this.handleCacheReady=false;function B(aq,au,at,aw,az){var av=[],ay=0,ax=[],ar=0;if(typeof aq==="number"){av[0]=aq.toString(10)}else{if(typeof aq==="string"){av=aq.split(".")}else{j("TAME library error: Can't parse name of object/variable. Name is not a string or number!");j(aq);return}}if(at===undefined){at=window}ay=av.length-1;while(ar<ay){if(av[ar].charAt(av[ar].length-1)==="]"){ax=av[ar].substring(0,av[ar].length-1).split("[");at=at[ax[0]][ax[1]]}else{if(at[av[ar]]===undefined){at[av[ar]]=[]}at=at[av[ar]]}ar++}if(av[ar].charAt(av[ar].length-1)==="]"){ax=av[ar].substring(0,av[ar].length-1).split("[");at=at[ax[0]];if(au!==undefined){if(typeof aw==="string"){au=aw+au}if(typeof az==="string"){au=au+az}at[ax[1]]=au}return at[ax[1]]}if(au!==undefined){if(typeof aw==="string"){au=aw+au}if(typeof az==="string"){au=au+az}at[av[ar]]=au}return at[av[ar]]}function an(aq){if(aq===undefined){return false}if(!isNaN(aq)&&aq>0&&aq<=ac.maxStringLen){return true}j("TAME library error: User defined string length not valid! length: "+aq);j("Max. string length: "+ac.maxStringLen);return false}function z(ar){var aq;if(ar.addr){if(typeof ar.addr==="string"&&ar.addr.charAt(0)==="%"){if(ar.addr.charAt(2)==="X"){aq=k[ar.addr.substr(1,2)]}else{aq=k[ar.addr.substr(1,1)]}}else{j('TAME library error: Wrong address definition, should be a string and start with "%"!');j(ar);return}}else{if(ar.useHandle===true||e.useHandles===true){aq=k.ValueByHandle}else{if(ar.symbolName){if(typeof ar.symbolName==="string"){try{aq=R[ar.symbolName].indexGroup}catch(at){j("TAME library error: Can't get the IndexGroup for this request!");j("TAME library error: Please check the variable name.");j(at);j(ar);return}}else{j("TAME library error: Varible name should be a string!");j(ar);return}}else{j("TAME library error: No name, address or handle for the variable/request defined!");j(ar);return}}}if(isNaN(aq)){j("TAME library error: IndexGroup is not a number, check address or name definition of the variable/request!");j(ar)}return aq}function i(ax){var au,ar="",aw=[],at,az,aq,ay,aB,aA;if(ax.addr){if(typeof ax.addr==="string"&&ax.addr.charAt(0)==="%"){if(ax.addr.charAt(2)==="X"){ar=ax.addr.substr(3);aw=ar.split(".");au=parseInt(aw[0],10)*8+parseInt(aw[1],10)}else{au=parseInt(ax.addr.substr(3),10);if(typeof ax.addrOffset==="number"){au+=ax.addrOffset}}}else{j('TAME library error: Wrong address definition, should be a string and start with "%"!');j(ax);return}}else{if(ax.useHandle===true||e.useHandles===true){if(ac.handleCacheReady===true){au=O[ax.fullSymbolName];if(isNaN(au)){j("TAME library error: Could not get the handle for this symbol name: "+ax.fullSymbolName);j(ax);return}}else{j("TAME library error: Could not get the handle for this request. Handle cache is not ready.");j(ax);return}}else{if(ax.symbolName){if(typeof ax.symbolName==="string"){try{au=R[ax.symbolName].indexOffset;if(typeof ax.symbolNameArrIdx==="number"){au+=R[ax.symbolName].itemSize*(ax.symbolNameArrIdx-R[ax.symbolName].arrStartIdx)}if(typeof ax.addrOffset==="number"){au+=ax.addrOffset}if(typeof ax.offs==="string"){au+=parseInt(ax.offs,10)/8}else{if(typeof ax.offs==="number"){au+=ax.offs/8}}if(ax.dataTypeNames.length>0){aq=ax.dataTypeNames;az=R[ax.symbolName].dataType;for(at=0;at<aq.length;at++){aA=ap[az].subItems[aq[at]];au+=aA.bitOffset/8;if(typeof ax.dataTypeArrIdx[at]==="number"){au+=aA.itemSize*(ax.dataTypeArrIdx[at]-aA.arrStartIdx)}az=ap[az].subItems[aq[at]].dataType}}}catch(av){j("TAME library error: Can't get the IndexOffset for this request!");j("TAME library error: Please check the variable definition (name/offs/subitem).");j(av);j(ax);return}}else{j("TAME library error: Varible name should be a string!");j(ax);return}}else{j("TAME library error: Neither a name nor an address for the variable/request defined!");j(ax);return}}}if(isNaN(au)){j("TAME library error: IndexOffset is not a number, check address or name definition of the variable/request.");j("IndexOffset: "+au);j(ax)}return au}function am(az){var aq={},ay,at;if(typeof az.name==="string"){az.name=az.name.toUpperCase();ay=az.name.split(".")}else{return aq}aq.fullSymbolName=az.name;if(ay[0]===""){aq.symbolName="."+ay[1]}else{aq.symbolName=ay[0]+"."+ay[1]}if(aq.symbolName.charAt(aq.symbolName.length-1)==="]"){at=aq.symbolName.substring(0,aq.symbolName.length-1).split("[");aq.symbolName=at[0];aq.symbolNameArrIdx=parseInt(at[1],10)}aq.dataTypeNames=ay.slice(2);var au=[],aw,ax,ar;if(ac.symTableReady&&ac.dataTypeTableReady&&aq.dataTypeNames.length>0){aw=aq.dataTypeNames;ax=R[aq.symbolName].dataType;aq.dataTypeArrIdx=[];ar=0;do{if(aw[ar].charAt(aw[ar].length-1)==="]"){at=aw[ar].substring(0,aw[ar].length-1).split("[");aw[ar]=at[0];aq.dataTypeArrIdx[ar]=parseInt(at[1],10)}if(ap[ax].subItems[aw[ar]].pointer===true){j("TAME library error: PLC variable "+[aw[ar]]+" is a pointer! Can't get the variable value.")}if(ar===aw.length-1){break}ax=ap[ax].subItems[aw[ar]].dataType;ar++}while(ar<aw.length);try{if(az.type===undefined){aq.type=ap[ax].subItems[aw[ar]].type}aq.arrayLength=ap[ax].subItems[aw[ar]].arrayLength;aq.arrayDataType=ap[ax].subItems[aw[ar]].arrayDataType;aq.dataType=ap[ax].subItems[aw[ar]].dataType;aq.itemSize=ap[ax].subItems[aw[ar]].itemSize;if(aq.size===undefined){aq.size=ap[ax].subItems[aw[ar]].size}aq.bitOffset=ap[ax].subItems[aw[ar]].bitOffset;aq.offs=az.offs;if(aq.type==="STRING"||aq.arrayDataType==="STRING"){aq.stringLength=ap[ax].subItems[aw[ar]].stringLength;aq.format=aq.stringLength}else{if(typeof az.format==="string"){aq.format=az.format}else{if(typeof az.decPlaces==="number"){aq.format=az.decPlaces}else{if(typeof az.dp==="number"){aq.format=az.dp}}}}if(aq.dataTypeArrIdx[ar]!==undefined&&aq.type==="ARRAY"){aq.type=ap[ax].subItems[aw[ar]].arrayDataType;aq.size=ap[ax].subItems[aw[ar]].itemSize}}catch(av){j("TAME library error: A problem occured while reading a data type from the data type table!");j(av);j(az)}}else{if(ac.symTableReady){try{if(az.type===undefined){aq.type=R[aq.symbolName].type}aq.arrayLength=R[aq.symbolName].arrayLength;aq.arrayDataType=R[aq.symbolName].arrayDataType;aq.dataType=R[aq.symbolName].dataType;aq.itemSize=R[aq.symbolName].itemSize;if(aq.size===undefined){aq.size=R[aq.symbolName].size}aq.bitOffset=R[aq.symbolName].bitOffset;aq.offs=az.offs;if(aq.type==="STRING"||aq.arrayDataType==="STRING"){aq.stringLength=R[aq.symbolName].stringLength;aq.format=aq.stringLength}else{if(typeof az.format==="string"){aq.format=az.format}else{if(typeof az.decPlaces==="number"){aq.format=az.decPlaces}else{if(typeof az.dp==="number"){aq.format=az.dp}}}}if(aq.symbolNameArrIdx!==undefined&&aq.type==="ARRAY"){aq.type=R[aq.symbolName].arrayDataType;aq.size=R[aq.symbolName].itemSize}}catch(av){j("TAME library error: A problem occured while reading a data type from the symbol table!");j(av);j(az)}}}if(typeof az.type=="string"){au=az.type.split(".");aq.type=au[0];if(au.length>2){au[1]=au.slice(1).join(".")}if(aq.type==="STRING"){au[1]=parseInt(au[1],10);if(an(au[1])){aq.format=au[1]}else{aq.format=C.STRING;j("TAME library warning: Length of string variable not defined: "+az.name);j("TAME library warning: A length of 80 characters (TwinCAT default) will be used.")}aq.stringLength=aq.format;aq.size=aq.format++}else{if(aq.type==="ARRAY"){}else{if(aq.type==="USER"){}else{aq.format=au[1];aq.size=C[aq.type]}}}if(typeof az.format==="string"){aq.format=az.format}else{if(typeof az.decPlaces==="number"){aq.format=az.decPlaces}else{if(typeof az.dp==="number"){aq.format=az.dp}}}}if(typeof aq.type!="string"){j("TAME library error: Could not get the type of the item!");j(az)}return aq}function ab(){var ar;if(window.XMLHttpRequest){ar=new window.XMLHttpRequest()}else{try{ar=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(at){try{ar=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(aq){ar=null;j("TAME library error: Failed Creating XMLHttpRequest-Object!")}}}return ar}function u(aq){if(aq.reqDescr===undefined){aq.reqDescr={}}else{if(aq.reqDescr.debug){j(aq)}}aq.send=function(){var ar,at;if(typeof this.reqDescr.id==="number"&&F[this.reqDescr.id]>0){j("TAME library warning: Request dropped (last request with ID "+aq.reqDescr.id+" not finished!)");F[this.reqDescr.id]++;if(F[this.reqDescr.id]<=ac.maxDropReq){return}F[this.reqDescr.id]=0}if(aq.sync===true){at=false}else{if(this.reqDescr.sync===true){at=false}else{if(this.reqDescr.sync===false){at=true}else{if(e.syncXmlHttp===true){at=false}else{at=true}}}}this.xmlHttpReq=ab();ar="<?xml version='1.0' encoding='utf-8'?>";ar+="<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ";ar+="xmlns:xsd='http://www.w3.org/2001/XMLSchema' ";ar+="xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>";ar+="<soap:Body><q1:";ar+=this.method;ar+=" xmlns:q1='http://beckhoff.org/message/'><netId xsi:type='xsd:string'>";ar+=e.amsNetId;ar+="</netId><nPort xsi:type='xsd:int'>";ar+=e.amsPort;ar+="</nPort>";if(this.indexGroup!==undefined){ar+="<indexGroup xsi:type='xsd:unsignedInt'>";ar+=this.indexGroup;ar+="</indexGroup>"}if(this.indexOffset!==undefined){ar+="<indexOffset xsi:type='xsd:unsignedInt'>";ar+=this.indexOffset;ar+="</indexOffset>"}if((this.method==="Read"||this.method==="ReadWrite")&&this.reqDescr.readLength>0){ar+="<cbRdLen xsi:type='xsd:int'>";ar+=this.reqDescr.readLength;ar+="</cbRdLen>"}if(this.pData&&this.pData.length>0){ar+="<pData xsi:type='xsd:base64Binary'>";ar+=this.pData;ar+="</pData>"}if(this.pwrData&&this.pwrData.length>0){ar+="<pwrData xsi:type='xsd:base64Binary'>";ar+=this.pwrData;ar+="</pwrData>"}ar+="</q1:";ar+=this.method;ar+="></soap:Body></soap:Envelope>";if(typeof this.xmlHttpReq==="object"){this.xmlHttpReq.open("POST",e.serviceUrl,at,e.serviceUser,e.servicePassword);this.xmlHttpReq.setRequestHeader("SOAPAction","http://beckhoff.org/action/TcAdsSync."+this.method);this.xmlHttpReq.setRequestHeader("Content-Type","text/xml; charset=utf-8");if(at===true){this.xmlHttpReq.onreadystatechange=function(){if((aq.xmlHttpReq.readyState===4)&&(aq.xmlHttpReq.status===200)){ac.parseResponse(aq)}};this.xmlHttpReq.send(ar)}else{this.xmlHttpReq.send(ar);ac.parseResponse(aq)}if(typeof this.reqDescr.id==="number"){F[this.reqDescr.id]=1}}};return aq}function W(au,at,ar,aq){var av;if(typeof au.val==="string"){if(at==="REAL"||at==="LREAL"){av=parseFloat(au.val)}else{av=parseInt(au.val,10)}}else{if(typeof au.val==="number"){av=au.val}else{j("TAME library error: Wrong variable type for a numeric variable in write request!");j("TAME library error: Variable type should be number or string, but is "+typeof au.val);j(au);av=0}}if(isNaN(av)){av=0;j("TAME library error: Value of a numeric variable in write request is not a number.");j(au)}if(ac.useCheckBounds===true){if(at==="LREAL"){if(!isFinite(av)){j("TAME library warning: Limit for LREAL value exceeded!");j("Upper limit: "+Number.MAX_VALUE);j("Lower limit: "+Number.MIN_VALUE);j("value: "+av);j(au)}}else{if(at==="REAL"){if(av>0){if(av<1.175495e-38){j("TAME library warning: Lower limit for positive REAL value exceeded!");j("limit: 1.175495e-38");j("value: "+av);j(au);av=1.175495e-38}else{if(av>3.402823e+38){j("TAME library warning: Upper limit for positive REAL value exceeded!");j("limit: 3.402823e+38");j("value: "+av);j(au);av=3.402823e+38}}}else{if(av<0){if(av>-1.175495e-38){j("TAME library warning: Upper limit for negative REAL value exceeded!");j("limit: -1.175495e-38");j("value: "+av);j(au);av=-1.175495e-38}else{if(av<-3.402823e+38){j("TAME library warning: Lower limit for negative REAL value exceeded!");j("limit: -3.402823e+38");j("value: "+av);j(au);av=-3.402823e+38}}}}}else{if(av<ar){j("TAME library warning: Lower limit for numeric value exceeded!");j("type: "+at);j("limit: "+ar);j("value: "+av);j(au);av=ar}else{if(av>aq){j("TAME library warning: Upper limit for numeric value exceeded!");j("type: "+at);j("limit: "+aq);j("value: "+av);j(au);av=aq}}}}}return av}function ak(au){var aq=[],av,ar,at;if(typeof au.type==="string"){aq=au.type.split(".");if(aq.length>2){aq[1]=aq.slice(1).join(".")}}else{j("TAME library error: Could not get the type of the item (function getTypeAndFormat())!");j(au)}return aq}function g(ar){var au={},aq,at;at=ap[ar].subItems;for(aq in at){if(at[aq].type==="USER"){j("TAME library error: Automatic creating of nested structures is not supported (yet)!");au[aq]=g(at[aq].dataType)}else{if(at.hasOwnProperty(aq)){au[aq]=at[aq].fullType}}}return au}function L(aq){if((aq>=97)&&(aq<=102)){return(aq-87)}if((aq>=65)&&(aq<=70)){return(aq-55)}if((aq>=48)&&(aq<=57)){return(aq-48)}return 0}function ai(av,ar){var aq=[],au=av.toString(16),at;while(au.length<ar*2){au="0"+au}for(at=0;at<ar;at++){aq[(ar-1)-at]=((L(au.charCodeAt(at*2))*16)+L(au.charCodeAt((at*2)+1)))}return aq}function q(ar){var av=0,ay=0,aw,aq,au,ax,at;aq=Math.abs(ar);if(ar!==0){for(at=128;at>-127;at--){au=aq/Math.pow(2,at);if(au>=2){break}ax=at;aw=au}ax+=127;aw=aw.toString(2);for(at=2;at<25;at++){av<<=1;if(aw.charAt(at)==="1"){av+=1}}if(aw.charAt(25)==="1"){av+=1}ay=ax;ay<<=23;ay+=av;if(ar<0){ay+=2147483648}}return ay}function E(ax){var at=0,az=0,au={part1:0,part2:0},aA,aw,ar,aq,ay,av;aA=Math.abs(ax);if(ax!==0){for(av=1024;av>=-1023;av--){aw=aA/Math.pow(2,av);if(aw>=2){break}ar=av;ay=aw}ar+=1023;ay=ay.toString(2);for(av=2;av<22;av++){at<<=1;if(ay.charAt(av)==="1"){at+=1}}if(ay.charAt(av)==="1"){aq=true}av++;for(av;av<54;av++){az<<=1;if(ay.charAt(av)==="1"){az+=1}}au.part1=ar;au.part1<<=20;au.part1+=at;if(ax<0){au.part1+=2147483648}au.part2=az;if(aq===true){au.part2+=2147483648}}return au}function M(at,ar){var aq;switch(ar){case"#d":case"#dd":aq=at*86400000;break;case"#h":case"#hh":aq=at*3600000;break;case"#m":case"#mm":aq=at*60000;break;case"#s":case"#ss":aq=at*1000;break;case"#ms":case"#msmsms":aq=at;break;default:aq=at;break}return aq}function D(ay,aA){var aq=aA.split("#"),ax=aq.length,az=/:|\.|-|_/,at=0,ar=0,av,au,aw,aB;for(au=1;au<ax;au++){if(az.test(aq[au])===true){aB=true}}if(aB!==true){j("TAME library error: No separator ( : . - _ ) for TOD string found!");j("String: "+ay);j("Format: "+aA);return 0}aw=ay.split(az);for(au=1;au<ax;au++){switch(aq[au]){case"h":case"hh":av=parseInt(aw[ar],10)*3600000;ar++;break;case"m":case"mm":av=parseInt(aw[ar],10)*60000;ar++;break;case"s":case"ss":av=parseInt(aw[ar],10)*1000;ar++;break;case"ms":case"msmsms":av=parseInt(aw[ar],10);ar++;break;default:av=0}at+=av}return at}function n(ax){var aw=l,au=0,ar="",av,at,aq;while(au<ax.length){av=ax[au++];at=ax[au++];aq=ax[au++];ar=ar+aw[av>>2]+aw[((av&3)<<4)|(at>>4)]+(isNaN(at)?"=":aw[(((at&15)<<2)|(aq>>6))])+((isNaN(at)||isNaN(aq))?"=":aw[aq&63])}return ar}function d(ax,av,aw,au){var az=[],aq,ay,ar,at;if(ax.val===undefined){switch(av){case"STRING":ax.val="";break;case"DATE":case"DT":case"TOD":case"TIME_OF_DAY":case"DATE_AND_TIME":ax.val=new Date();break;default:ax.val=0;break}j("TAME library warning: Value of a variable in write request is not defined!");j(ax)}switch(av){case"BOOL":if(ax.val){az[0]=1}else{az[0]=0}break;case"BYTE":case"USINT":aq=W(ax,av,0,255);az=ai(aq,au);break;case"SINT":aq=W(ax,av,-128,127);if(aq<0){aq=aq+256}az=ai(aq,au);break;case"WORD":case"UINT":aq=W(ax,av,0,65535);az=ai(aq,au);break;case"INT":case"INT16":aq=W(ax,av,-32768,32767);if(aq<0){aq=aq+65536}az=ai(aq,au);break;case"INT1DP":ax.val=Math.round(ax.val*10);aq=W(ax,av,-32768,32767);if(aq<0){aq=aq+65536}az=ai(aq,au);break;case"DWORD":case"UDINT":aq=W(ax,av,0,4294967295);az=ai(aq,au);break;case"DINT":aq=W(ax,av,-2147483648,2147483647);if(aq<0){aq=aq+4294967296}az=ai(aq,au);break;case"REAL":aq=W(ax,av);aq=q(aq);az=ai(aq,au);break;case"LREAL":aq=W(ax,av);aq=E(aq);az=ai(aq.part2,4);az=az.concat(ai(aq.part1,4));break;case"DATE":if(typeof ax.val==="object"){ax.val.setHours(0);ax.val.setMinutes(0);ax.val.setSeconds(0);aq=ax.val.getTime()/1000-ax.val.getTimezoneOffset()*60}else{j("TAME library error: Value of a DATE variable in write request is not a date object!");j(ax)}az=ai(aq,au);break;case"DT":case"DATE_AND_TIME":if(typeof ax.val==="object"){aq=ax.val.getTime()/1000-ax.val.getTimezoneOffset()*60}else{j("TAME library error: Value of a DT variable in write request is not a date object!");j(ax)}az=ai(aq,au);break;case"TOD":case"TIME_OF_DAY":if(typeof ax.val==="object"){ax.val.setYear(1970);ax.val.setMonth(0);ax.val.setDate(1);aq=ax.val.getTime()-ax.val.getTimezoneOffset()*60000}else{if(typeof ax.val==="string"){if(aw===""||aw===undefined){aw="#hh#:#mm";j("TAME library warning: No format given for TOD string! Using default #hh#:#mm.");j(ax)}aq=D(ax.val,aw)}else{j("TAME library error: TOD value in write request is wether a date object nor a string!");j(ax)}}az=ai(aq,au);break;case"STRING":ay=(aw===undefined)?C.STRING:parseInt(aw,10);if(an(ay)){ar=ay<ax.val.length?ay:ax.val.length;for(at=0;at<ar;at++){az[at]=ax.val.charCodeAt(at)}for(at;at<ay;at++){az[at]=0}az[at]=0}break;case"TIME":aq=parseInt(ax.val,10);if(isNaN(aq)){j("TAME library warning: Value of a TIME variable in write request is not defined!");j(ax);aq=0}aq=M(aq,aw);if(aq<0){aq=0;j("TAME library warning: Lower limit for TIME variable in write request exceeded!)");j("value: "+ax.val+aw);j(ax)}else{if(aq>4294967295){aq=4294967295;j("TAME library warning: Upper limit for TIME variable in write request exceeded!)");j("value: "+ax.val+aw);j(ax)}}az=ai(aq,au);break;case"EndStruct":break;default:j("TAME library error: Unknown data type in write request : "+av);break}return az}function s(ar){var aq=ar.toString(16);if((aq.length%2)!==0){aq="0"+aq}return aq}function h(ar,aq){aq=(isNaN(aq))?0:aq;var at=ar.toString(10);while(at.length<aq){at="0"+at}return at}function ao(ax,aw){var aq=aw.split("#"),av=aq.length,ar="",au,at;for(at=1;at<av;at++){switch(aq[at]){case"D":au=ax.getDate();break;case"DD":au=ax.getDate();au=h(au,2);break;case"WD":au=ax.getDay();break;case"WKD":au=ac.dateNames.weekdShort[ax.getDay()];break;case"WEEKDAY":au=ac.dateNames.weekdLong[ax.getDay()];break;case"M":au=ax.getMonth()+1;break;case"MM":au=ax.getMonth()+1;au=h(au,2);break;case"MON":au=ac.dateNames.monthsShort[ax.getMonth()];break;case"MONTH":au=ac.dateNames.monthsLong[ax.getMonth()];break;case"YY":au=ax.getYear();while(au>100){au-=100}break;case"YYYY":au=ax.getFullYear();break;case"h":au=ax.getHours();break;case"hh":au=ax.getHours();au=h(au,2);break;case"m":au=ax.getMinutes();break;case"mm":au=ax.getMinutes();au=h(au,2);break;case"s":au=ax.getSeconds();break;case"ss":au=ax.getSeconds();au=h(au,2);break;case"ms":au=ax.getMilliseconds();break;case"msmsms":au=ax.getMilliseconds();au=h(au,3);break;default:au=aq[at];break}ar=ar+au}return ar}function K(ax,aw){var aq=aw.split("#"),av=aq.length,ar="",au,at;for(at=1;at<av;at++){switch(aq[at]){case"d":if(av<=2){au=ax/86400000}else{au=Math.floor(ax/86400000);ax=ax%86400000}break;case"dd":if(av<=2){au=ax/86400000}else{au=Math.floor(ax/86400000);ax=ax%86400000}au=h(au,2);break;case"h":if(av<=2){au=ax/3600000}else{au=Math.floor(ax/3600000);ax=ax%3600000}break;case"hh":if(av<=2){au=ax/3600000}else{au=Math.floor(ax/3600000);ax=ax%3600000}au=h(au,2);break;case"m":if(av<=2){au=ax/60000}else{au=Math.floor(ax/60000);ax=ax%60000}break;case"mm":if(av<=2){au=ax/60000}else{au=Math.floor(ax/60000);ax=ax%60000}au=h(au,2);break;case"s":if(av<=2){au=ax/1000}else{au=Math.floor(ax/1000);ax=ax%1000}break;case"ss":if(av<=2){au=ax/1000}else{au=Math.floor(ax/1000);ax=ax%1000}au=h(au,2);break;case"ms":au=ax;break;case"msmsms":au=ax;au=h(au,3);break;default:au=aq[at];break}ar=ar+au}return ar}function U(ar){var aq=s(ar.charCodeAt(0));return parseInt(aq,16)}function aj(aq){var ar=U(aq);if(ar>127){ar=ar-256}return ar}function Q(ar){var aq=s(ar.charCodeAt(1));aq+=s(ar.charCodeAt(0));return parseInt(aq,16)}function P(aq){var ar=Q(aq);if(ar>32767){ar=ar-65536}return ar}function H(ar){var aq=s(ar.charCodeAt(3));aq+=s(ar.charCodeAt(2));aq+=s(ar.charCodeAt(1));aq+=s(ar.charCodeAt(0));return parseInt(aq,16)}function S(aq){var ar=H(aq);if(ar>2147483647){ar=ar-4294967296}return ar}function aa(aq,at){var ar=H(aq);if(at===undefined){return ar}return(K(ar,at))}function m(aq,at){var ar=new Date(H(aq));ar=new Date(ar.getTime()+ar.getTimezoneOffset()*60000);if(at===undefined){return ar}return(ao(ar,at))}function ah(ar,at){var aq=new Date(H(ar)*1000);aq=new Date(aq.getTime()+aq.getTimezoneOffset()*60000);if(at===undefined){return aq}return(ao(aq,at))}function p(at){var av=1,ax=0.5,ar=H(at),aq,aw,au;if(ar===0){return 0}aq=((ar>>>31)===1)?"-":"+";ar<<=1;aw=(ar>>>24)-127;ar<<=8;for(au=1;au<=23;au++){av+=ar<0?ax:0;ar<<=1;ax/=2}return parseFloat(aq+(av*Math.pow(2,aw)))}function G(at){var ar=H(at.substring(4,8)),aw=H(at.substring(0,4)),av=12,au=1,ay=0.5,aq,ax;if(ar===0&&aw===0){return 0}aq=((ar>>>31)===1)?"-":"+";ar<<=1;ax=(ar>>>21)-1023;ar<<=11;while(av<32){au+=ar<0?ay:0;ar<<=1;ay/=2;av++}if((aw>>>31)===1){au+=ay;aw<<=1;ay/=2}while(av<64){au+=aw<0?ay:0;aw<<=1;ay/=2;av++}return parseFloat(aq+(au*Math.pow(2,ax)))}function af(aq){return aq.split(String.fromCharCode(0))[0]}function T(au){var av=o,ax=0,aq="",aw,at,ar,aB,aA,az,ay;au=au.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{aB=av[au.charAt(ax++)];aA=av[au.charAt(ax++)];az=av[au.charAt(ax++)];ay=av[au.charAt(ax++)];aw=(aB<<2)|(aA>>4);at=((aA&15)<<4)|(az>>2);ar=((az&3)<<6)|ay;aq+=String.fromCharCode(aw);if(az!==64){aq+=String.fromCharCode(at)}if(ay!==64){aq+=String.fromCharCode(ar)}}while(ax<au.length);return aq}function Y(ar,aq,au){var at;switch(aq){case"BOOL":at=(ar.charCodeAt(0)!="0");break;case"BYTE":case"USINT":at=U(ar);break;case"SINT":at=aj(ar);break;case"WORD":case"UINT":at=Q(ar);break;case"INT":case"INT16":at=P(ar);break;case"INT1DP":at=((P(ar))/10).toFixed(1);break;case"DWORD":case"UDINT":at=H(ar);break;case"DINT":at=S(ar);break;case"REAL":at=p(ar);if(au!==undefined){at=at.toFixed(parseInt(au,10))}break;case"LREAL":at=G(ar);if(au!==undefined){at=at.toFixed(parseInt(au,10))}break;case"STRING":at=af(ar);break;case"TOD":case"TIME_OF_DAY":at=m(ar,au);break;case"TIME":at=aa(ar,au);break;case"DT":case"DATE":case"DATE_AND_TIME":at=ah(ar,au);break;case"EndStruct":break;default:j("TAME library error: Unknown data type at parsing read request: "+aq);break}return at}function x(aJ){var aq,aB=aJ.reqDescr.items,az=[],aC=0,aG,at,au,aI,ax,aE,ay,aH,ar,aD,aA,av,aw;try{aq=aJ.xmlHttpReq.responseXML.documentElement;at=T(aq.getElementsByTagName("ppData")[0].firstChild.data);for(aA=0,av=aB.length;aA<av;aA++){aG=aB[aA];az=ak(aG);ar=az[0];aD=az[1];aE=C[ar];switch(ar){case"STRING":if(aD!==undefined){ax=parseInt(aD,10)}aE=(an(ax)?ax:aE)+1;break;case"EndStruct":aE=aG.val;break}ay=aE<a?aE:a;if(aJ.reqDescr.seq!==true){aw=i(aJ.reqDescr);aC=aG.addr-aw}else{if(aJ.reqDescr.calcAlignment===true&&ay>1&&ar!=="EndStruct"&&ar!=="STRING"&&aC>0){aH=aC%ay;if(aH>0){aC+=ay-aH}}}au=at.substr(aC,aE);aI=Y(au,ar,aD);if(ar!=="EndStruct"){B(aG.jvar,aI,aJ.reqDescr.dataObj,aG.prefix,aG.suffix)}if(aJ.reqDescr.seq===true){aC+=aE}}}catch(aF){j("TAME library error: Parsing of Read Request failed:"+aF);j(aG);return}}function c(aQ){var aq,aE=aQ.reqDescr.items,aB=[],aI=0,at=0,aG=window,aN=0,aM,av,aw,aP,aK,au,aJ,aC,az,ax,aF,aH,aA,ay,aD;function ar(){var aS,aR;if(au==="STRING"){if(aJ!==undefined){aS=parseInt(aJ,10)}else{if(typeof aD.stringLength==="number"){aS=aD.stringLength}}aK=(an(aS)?aS:aK)+1}aR=aw.substr(at,aK);aP=Y(aR,au,aJ);B(aF,aP,aG,aM.prefix,aM.suffix);at+=aK}function aO(){var aT,aS,aX,aW,aU,aV;function aR(){var aZ,aY;if(a>1&&au!=="STRING"&&au!=="EndStruct"){aZ=aK<a?aK:a;if(aZ>1&&at>0){aY=at%aZ;if(aY>0){at+=aZ-aY}}if(aZ>aN){aN=aZ}}}if(typeof aM.def==="string"){aM.def=B(aM.def)}else{if(ac.dataTypeTableReady===true&&aM.def===undefined){aM.def=g(aD.dataType)}else{if(typeof aM.def!=="object"){j("TAME library error: No structure defininition found!")}}}for(aV in aM.def){if(aM.def.hasOwnProperty(aV)){aS=aM.def[aV].split(".");if(aS[0]==="ARRAY"){aX=parseInt(aS[1],10);aW=aS.length-1;for(aT=0;aT<aX;aT++){au=aS[2];if(aS[aW]==="SP"){aF=aV+aT;if(aW>=4){aJ=aS.slice(3,-1).join(".")}}else{aF=aV+"."+aT;if(aW>=3){aJ=aS.slice(3).join(".")}}if(aH!==null){aF=aH+"."+aF}aK=C[au];aR();ar()}}else{if(aH!==null){aF=aH+"."+aV}else{aF=aV}au=aS[0];if(aS.length>2){aS[1]=aS.slice(1).join(".")}aJ=aS[1];aK=C[au];aR();ar()}}}if(a>1&&aN>1&&au!=="STRING"&&au!=="EndStruct"){if(aN>a){aN=a}aU=at%aN;if(aU>0){at+=aN-aU}}}try{aq=aQ.xmlHttpReq.responseXML.documentElement;av=T(aq.getElementsByTagName("ppRdData")[0].firstChild.data);for(aC=0,az=aE.length;aC<az;aC++){aw=av.substr(aI,4);ax=Y(aw,"DWORD");if(ax!==0){j("TAME library error: ADS sub command error while processing a SumReadRequest!");j("Error code: "+ax);j(aE[aC])}aI+=4}for(aC=0;aC<az;aC++){aM=aE[aC];aD=am(aM);au=aD.type;aJ=aD.format;ay=aD.size;aH=null;aw=av.substr(aI,ay);switch(au){case"ARRAY":aG=B(aM.jvar);at=0;aA=aD.arrayLength;if(aD.arrayDataType==="USER"){for(aH=0;aH<aA;aH++){aO()}}else{au=aD.arrayDataType;aK=C[au];for(aH=0;aH<aA;aH++){aF=aH;ar()}}break;case"USER":aG=B(aM.jvar);at=0;aO();break;default:aG=window;aP=Y(aw,au,aJ);B(aM.jvar,aP,aG,aM.prefix,aM.suffix)}aI+=ay}}catch(aL){j("TAME library error: Parsing of SumReadRequest failed:"+aL);j(aM);return}}function y(aK){var aq,aB=aK.reqDescr.items,az=[],aD=0,ar=0,aC=window,aH,au,av,aJ,aF,at,aE,aA,ax,aw,ay,aI;try{aq=aK.xmlHttpReq.responseXML.documentElement;au=T(aq.getElementsByTagName("ppRdData")[0].firstChild.data);for(aA=0,ax=aB.length;aA<ax;aA++){av=au.substr(aD,4);aw=Y(av,"DWORD");if(aw===0){if(aK.reqDescr.isRelHdlReq===true){aI=aB[aA].toUpperCase();delete O[aI];ay=r.indexOf(aI);delete r[ay]}}else{j("TAME library error: ADS sub command error while processing a SumReadRequest!");j("Error code: "+aw);j(aB[aA])}aD+=4}if(aK.reqDescr.isRelHdlReq===true){for(aA=r.length-1;aA>=0;aA--){if(r[aA]===undefined){r.splice(aA,1)}}if(r.length===0){ac.handleCacheReady=false;j("TAME library info: All handles released.")}}}catch(aG){j("TAME library error: Parsing of SumWriteRequest failed:"+aG);j(aH);return}}function al(at){var aq;try{aq=at.xmlHttpReq.responseXML.documentElement;ac.adsState=parseInt(aq.getElementsByTagName("pAdsState")[0].firstChild.data,10);ac.adsStateTxt=V[ac.adsState];ac.deviceState=parseInt(aq.getElementsByTagName("pDeviceState")[0].firstChild.data,10)}catch(ar){j("TAME library error: Parsing of ADS Read State Request failed:"+ar);return}}function X(aB){var au,av=r,ar=0,aq=0,aw,at,ax,aA,ay,az,aC;au=aB.xmlHttpReq.responseXML.documentElement;aw=T(au.getElementsByTagName("ppRdData")[0].firstChild.data);for(aA=0,ay=av.length;aA<ay;aA++){at=aw.substr(ar,4);az=Y(at,"DWORD");ar+=4;at=aw.substr(ar,4);aC=Y(at,"DWORD");ar+=4;if(az!==0){j("TAME library error: Error while reading a handle from the PLC!");j("Error code: "+az);j("Handle: "+av[aA]);throw"Handle request aborted!"}}for(aA=0;aA<ay;aA++){at=aw.substr(ar,4);ax=Y(at,"DWORD");ar+=4;O[av[aA]]=ax}ac.handleCacheReady=true;j("TAME library info: Handle cache ready.")}function N(ax,aw,au){var at={},av,aq,ar;au.type=aw;ar=am(au);aq=C[aw];switch(aw){case"STRING":if(an(au.strlen)){aw+="."+au.strlen;aq=au.strlen}else{if(typeof ar.stringLength==="number"){aq=ar.stringLength;aw+="."+aq}else{j("TAME library error: Could not get the length of the string for this request!");j(au)}}aq++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof au.format==="string"){aw+="."+au.format}break;case"REAL":case"LREAL":if(typeof au.decPlaces==="number"){aw+="."+au.decPlaces}else{if(typeof au.dp==="number"){aw+="."+au.dp}}break}at={addr:au.addr,symbolName:ar.symbolName,dataTypeNames:ar.dataTypeNames,dataTypeArrIdx:ar.dataTypeArrIdx,symbolNameArrIdx:ar.symbolNameArrIdx,fullSymbolName:au.name,useHandle:au.handle,id:au.id,oc:au.oc,ocd:au.ocd,readLength:aq,debug:au.debug,sync:au.sync,offs:au.offs,seq:true,items:[{val:au.val,jvar:au.jvar,type:aw,prefix:au.prefix,suffix:au.suffix}]};if(ax==="Write"){ac.writeReq(at)}else{ac.readReq(at)}}function I(au,av,at){var aw={},aI={},aC,ar,aK=0,aL=0,aJ=0,aM,aq=[],aO,ay,aB=0,aD,az,aN=0,aE=0,aQ,aA,aP,aG,aF;aF=am(at);if(au==="Write"&&typeof at.val==="object"){aI=at.val}else{if(typeof at.jvar==="string"){aI=B(at.jvar)}else{j("TAME library error: No data object for this "+au+"-Request defined!")}}if(typeof at.arrlen==="number"){aC=at.arrlen}else{if(aF.arrayLength!==undefined){aC=aF.arrayLength}else{j("TAME library error: Can't get the array length for this request!");j(at)}}if(typeof at.item==="number"&&!isNaN(at.item)&&au==="Write"){aP=true;if(at.item<0||at.item>aC-1){j('TAME library error: Wrong value for "item"!');j("item: "+at.item);j("Last array index: "+(aC-1))}}function ax(){var aR;if(typeof at.def==="string"){at.def=B(at.def)}else{if(ac.dataTypeTableReady===true&&at.def===undefined){at.def=g(aF.dataType)}else{if(typeof at.def!=="object"){j("TAME library error: No structure definition found!")}}}for(aR in at.def){if(at.def.hasOwnProperty(aR)){aq=at.def[aR].split(".");if(aq[0]==="ARRAY"){aO=parseInt(aq[1],10);aq.shift();aq.shift()}else{aO=1}for(aL=0;aL<aO;aL++){if(aq[0]==="STRING"){if(typeof aq[1]==="string"){aD=parseInt(aq[1],10)}az=(an(aD)?aD:C[aq[0]])+1}else{az=C[aq[0]]}if(a>1&&az>1&&aq[0]!=="STRING"&&aB>0){aQ=aB%az;if(aQ>0){aB+=az-aQ}}aB+=az}if(a>1&&az>aN&&aq[0]!=="STRING"){aN=az}}}if(a>1&&aN>1&&aq[0]!=="STRING"){if(aN>a){aN=a}aQ=aB%aN;if(aQ>0){aE=aN-aQ;aB+=aE}}if(aP){ar=aB*at.item;aC=1}aw={addr:at.addr,symbolName:aF.symbolName,dataTypeNames:aF.dataTypeNames,fullSymbolName:at.name,addrOffset:ar,useHandle:at.handle,id:at.id,oc:at.oc,ocd:at.ocd,debug:at.debug,readLength:aB*aC,seq:true,calcAlignment:true,dataObj:aI,sync:at.sync,offs:at.offs,items:[]};for(aL=0;aL<aC;aL++){for(aR in at.def){if(at.def.hasOwnProperty(aR)){aq=at.def[aR].split(".");if(aq[0]==="ARRAY"){aO=parseInt(aq[1],10);ay=aq.length-1;for(aJ=0;aJ<aO;aJ++){if(aq[ay]==="SP"){aw.items[aK]={jvar:aL+"."+aR+aJ};if(ay===4){aw.items[aK].type=aq[2]+"."+aq[3]}else{aw.items[aK].type=aq[2]}}else{aw.items[aK]={jvar:aL+"."+aR+"."+aJ};if(ay===3){aw.items[aK].type=aq[2]+"."+aq[3]}else{aw.items[aK].type=aq[2]}}if(au==="Write"){if(aP){if(aq[ay]==="SP"){aw.items[aK].val=aI[at.item][aR+aJ]}else{aw.items[aK].val=aI[at.item][aR][aJ]}}else{if(aq[ay]==="SP"){aw.items[aK].val=aI[aL][aR+aJ]}else{aw.items[aK].val=aI[aL][aR][aJ]}}}aK++}}else{aw.items[aK]={jvar:aL+"."+aR,type:at.def[aR]};if(au==="Write"){if(aP){aw.items[aK].val=aI[at.item][aR]}else{aw.items[aK].val=aI[aL][aR]}}aK++}}}if(a>1){aw.items[aK]={type:"EndStruct",val:aE};aK++}}}function aH(){aM=C[av];switch(av){case"STRING":if(an(at.strlen)){av+="."+at.strlen;aM=at.strlen}else{if(typeof aF.stringLength==="number"){aM=aF.stringLength;av+="."+aM}else{j("TAME library error: Could not get the length of the string for this request!");j(at)}}aM++;break;case"TIME":case"TOD":case"DT":case"DATE":case"DATE_AND_TIME":case"TIME_OF_DAY":if(typeof at.format==="string"){av+="."+at.format}break;case"REAL":case"LREAL":if(typeof at.decPlaces==="number"){av+="."+at.decPlaces}else{if(typeof at.dp==="number"){av+="."+at.dp}}break}if(aP){ar=at.item*aM;aC=1}aw={addr:at.addr,symbolName:aF.symbolName,dataTypeNames:aF.dataTypeNames,dataTypeArrIdx:aF.dataTypeArrIdx,symbolNameArrIdx:aF.symbolNameArrIdx,fullSymbolName:at.name,useHandle:at.handle,addrOffset:ar,id:at.id,oc:at.oc,ocd:at.ocd,readLength:aM*aC,debug:at.debug,seq:true,dataObj:aI,items:[]};for(aL=0;aL<aC;aL++){aw.items[aL]={jvar:aL,type:av};if(au==="Write"){if(aP){aw.items[aL].val=aI[at.item]}else{aw.items[aL].val=aI[aL]}}}}if(av==="STRUCT"){ax()}else{aH()}if(au==="Write"){ac.writeReq(aw)}else{ac.readReq(aw)}}function ae(aq,aA){var ax={},ar={},aB=[],av=0,az,au,aw,ay,at;at=am(aA);if(aq==="Write"&&typeof aA.val==="object"){ar=aA.val}else{if(typeof aA.jvar==="string"){ar=B(aA.jvar)}else{j("TAME library error: No data object for this "+aq+"-Request defined!")}}if(typeof aA.def==="string"){aA.def=B(aA.def)}else{if(ac.dataTypeTableReady===true&&aA.def===undefined){aA.def=g(at.dataType)}else{if(typeof aA.def!=="object"){j("TAME library error: No structure defininition found!")}}}ax={addr:aA.addr,symbolName:at.symbolName,dataTypeNames:at.dataTypeNames,dataTypeArrIdx:at.dataTypeArrIdx,symbolNameArrIdx:at.symbolNameArrIdx,fullSymbolName:aA.name,useHandle:aA.handle,id:aA.id,oc:aA.oc,ocd:aA.ocd,debug:aA.debug,seq:true,calcAlignment:true,dataObj:ar,sync:aA.sync,offs:aA.offs,items:[]};for(aw in aA.def){if(aA.def.hasOwnProperty(aw)){aB=aA.def[aw].split(".");if(aB[0]==="ARRAY"){au=parseInt(aB[1],10);az=aB.length-1;for(ay=0;ay<au;ay++){if(aB[az]==="SP"){ax.items[av]={jvar:aw+ay};if(az===4){ax.items[av].type=aB[2]+"."+aB[3]}else{ax.items[av].type=aB[2]}}else{ax.items[av]={jvar:aw+"."+ay};if(az===3){ax.items[av].type=aB[2]+"."+aB[3]}else{ax.items[av].type=aB[2]}}if(aq==="Write"){if(aB[az]==="SP"){ax.items[av].val=ar[aw+ay]}else{ax.items[av].val=ar[aw][ay]}}av++}}else{ax.items[av]={jvar:aw,type:aA.def[aw]};if(aq==="Write"){ax.items[av].val=ar[aw]}av++}}}if(aq==="Write"){ac.writeReq(ax)}else{ac.readReq(ax)}}this.writeReq=function(au){var aw=au.items,aD={},aq=[],az=[],aG=[],ay,aC,at,ax,ar,aE,aA,aF,av,aB;if(typeof au.name==="string"){au.name=au.name.toUpperCase()}for(aB=0,at=aw.length;aB<at;aB++){aF=aw[aB];az=ak(aF);ay=az[0];aC=az[1];if(isNaN(C[ay])){j("TAME library error: Could not get the length of the data type: "+ay);j("TAME library error: Probably wrong type definition. Please check the manual.");j(au);return}ax=(C[ay]<a)?C[ay]:a;if(au.calcAlignment===true&&ax>1&&ay!=="STRING"&&ay!=="EndStruct"&&aq.length>0){aA=aq.length%ax;if(aA>0){aE=ax-aA;for(av=1;av<=aE;av++){aq.push(0)}}}if(ay==="EndStruct"){for(av=1;av<=aF.val;av++){aq.push(0)}}else{aG=d(aF,ay,aC,C[ay]);aq=aq.concat(aG)}}if(aq&&aq.length>0){aq=n(aq)}aD={method:"Write",indexGroup:z(au),indexOffset:i(au),pData:aq,reqDescr:au};u(aD).send()};this.readReq=function(at){var aB={},au=at.items,aw=[],aC,aA,av,aq,ax,ay,aD,az,ar;if(typeof at.readLength!=="number"){at.readLength=0;for(az=0,aq=au.length;az<aq;az++){aC=au[az];aw=ak(aC);av=aw[0];aA=aw[1];if(isNaN(C[av])){j("TAME library error: Could not get the length of the data type: "+av);j("TAME library error: Probably wrong type definition. Please check the manual.");j(at);return}if(av==="STRING"){if(typeof aA==="string"){aD=parseInt(aA,10)}ay=(an(aD)?aD:C[av])+1}else{ay=C[av]}if(at.seq===true){if(at.calcAlignment===true&&ay>1&&av!=="EndStruct"&&av!=="STRING"&&at.readLength>0){ax=at.readLength%ay;if(ax>0){at.readLength+=ay-ax}}at.readLength+=ay}else{ar=i(at);at.readLength=ay+aC.addr-ar}}}aB={method:"Read",indexGroup:z(at),indexOffset:i(at),reqDescr:at};u(aB).send()};this.sumReadReq=function(au){var aC={},aw=au.items,az=[],aE=[],aF=[],at=aw.length,av={},ay,aB,aD,aA,ax,aq,ar;au.readLength=at*4;for(aA=0;aA<at;aA++){aD=aw[aA];ar=am(aD);ax=ar.size;au.readLength+=ax;av.val=z(ar);aF=d(av,"UDINT",aB,4);aE=aE.concat(aF);av.val=i(ar);aF=d(av,"UDINT",aB,4);aE=aE.concat(aF);av.val=ax;aF=d(av,"UDINT",aB,4);aE=aE.concat(aF)}if(aE.length>0){aq=n(aE)}aC={method:"ReadWrite",indexGroup:k.SumRd,indexOffset:aw.length,pwrData:aq,reqDescr:au};u(aC).send()};this.sumWriteReq=function(au){var aN={},aB=au.items,ax=[],ar=[],az=[],av=aB.length,aK={},aI=0,at,aF,aH,ay,aG,aM,aE,aD,aw,aJ,aq,aA;function aC(){var aO;aG=C[at];if(at==="STRING"){if(aF!==undefined){aO=parseInt(aF,10)}else{if(typeof aA.stringLength==="number"){aO=aA.stringLength}}aF=(an(aO)?aO:aG)}}function aL(){var aR,aW,aO,aS,aU,aP,aQ=[];function aV(){var aY,aX;if(a>1&&at!=="STRING"&&at!=="EndStruct"){aY=aG<a?aG:a;if(aY>1&&aQ.length>0){aU=aQ.length%aY;if(aU>0){aq=aY-aU;for(aX=1;aX<=aq;aX++){aQ.push(0)}}}if(aY>aI){aI=aY}}}if(typeof aH.def==="string"){aH.def=B(aH.def)}else{if(ac.dataTypeTableReady===true&&aH.def===undefined){aH.def=g(aA.dataType)}else{if(typeof aH.def!=="object"){j("TAME library error: No structure defininition found!")}}}for(aP in aH.def){if(aH.def.hasOwnProperty(aP)){try{aW=aH.def[aP].split(".");if(aW[0]==="ARRAY"){aO=parseInt(aW[1],10);aS=aW.length-1;for(aR=0;aR<aO;aR++){at=aW[2];if(aW[aS]==="SP"){if(aS>=4){aF=aW.slice(3,-1).join(".")}}else{if(aS>=3){aF=aW.slice(3).join(".")}}if(aE!==null){if(aW[aS]==="SP"){aK.val=aH.val[aE][aP+aR]}else{aK.val=aH.val[aE][aP][aR]}}else{aK.val=aH.val[aP][aR]}aC();aV();az=d(aK,at,aF,aG);aQ=aQ.concat(az)}}else{if(aE!==null){aK.val=aH.val[aE][aP]}else{aK.val=aH.val[aP]}at=aW[0];if(aW.length>2){aW[1]=aW.slice(1).join(".")}aF=aW[1];aC();aV();az=d(aK,at,aF,aG);aQ=aQ.concat(az)}}catch(aT){j("TAME library error: Could not set values for a structure in SumWriteReq: "+aT);j(aH)}}}if(a>1&&aI>1&&aW[0]!=="STRING"&&aW[0]!=="EndStruct"){aU=aQ.length%aI;if(aU>0){aq=aI-aU;for(aD=1;aD<=aq;aD++){aQ.push(0)}}}ar=ar.concat(aQ)}au.readLength=av*4;for(ay=0;ay<av;ay++){aH=aB[ay];aA=am(aH);at=aA.type;aF=aA.format;aG=aA.size;aK.val=z(aA);az=d(aK,"UDINT",aF,4);ar=ar.concat(az);aK.val=i(aA);az=d(aK,"UDINT",aF,4);ar=ar.concat(az);aK.val=aG;az=d(aK,"UDINT",aF,4);ar=ar.concat(az)}for(ay=0;ay<av;ay++){aH=aB[ay];aA=am(aH);at=aA.type;aF=aA.format;aG=aA.size;aE=null;switch(at){case"ARRAY":aw=parseInt(aA.arrayLength,10);if(aw!==aH.val.length){j("TAME library error: Array length in JS differs from the length in the PLC!");j("Length in JS: "+aH.val.length);j("Length in PLC: "+aw);j(aH);return}if(aA.arrayDataType==="USER"){for(aE=0;aE<aw;aE++){aL()}}else{at=aA.arrayDataType;if(at==="STRING"){aF=aA.stringLength}else{aG=aA.itemSize}for(aE=0;aE<aw;aE++){aK.val=aH.val[aE];az=d(aK,at,aF,aG);ar=ar.concat(az)}}break;case"USER":aL();break;default:if(at==="STRING"){aF=aA.stringLength}else{aG=aA.size}az=d(aH,at,aF,aG);ar=ar.concat(az)}}if(ar.length>0){aM=n(ar)}aN={method:"ReadWrite",indexGroup:k.SumWr,indexOffset:aB.length,pwrData:aM,reqDescr:au};u(aN).send()};this.readAdsState=function(aq){var ar={method:"ReadState",reqDescr:aq};u(ar).send()};this.logHandleCache=function(){j(O)};this.logSymbols=function(){j(R)};this.logDataTypes=function(){j(ap)};this.getSymbolsAsJSON=function(){var ar;if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{ar=JSON.stringify(R);return ar}catch(aq){j("TAME library error: Could not convert the Symbol Table to JSON:"+aq)}}};this.setSymbolsFromJSON=function(ar){if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{R=JSON.parse(ar)}catch(aq){j("TAME library error: Could not create the Symbol Table from JSON:"+aq);return}ac.symTableReady=true;j("TAME library info: Symbol Table successfully created from JSON data.")}};this.getDataTypesAsJSON=function(){var ar;if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{ar=JSON.stringify(ap);return ar}catch(aq){j("TAME library error: Could not convert the Data Type Table to JSON:"+aq)}}};this.setDataTypesFromJSON=function(ar){if(typeof JSON!=="object"){j("TAME library error: No JSON parser found.")}else{try{ap=JSON.parse(ar)}catch(aq){j("TAME library error: Could not create the Data Type Table from JSON:"+aq);return}ac.dataTypeTableReady=true;j("TAME library info: Data Type Table successfully created from JSON data.")}};this.parseResponse=function(aw){var ar,av,aq;if(typeof aw.reqDescr.id==="number"){F[aw.reqDescr.id]=0}if(aw.xmlHttpReq.responseXML===null){j('TAME library error: Request contains no XML data. Object "responseXML" is null.');j('TAME library error: This is the "responseText":');j(aw.xmlHttpReq.responseText)}try{ar=aw.xmlHttpReq.responseXML.documentElement}catch(au){j("TAME library error: No XML data in server response:"+au);return}try{aq=ar.getElementsByTagName("faultstring")[0].firstChild.data;try{av=ar.getElementsByTagName("errorcode")[0].firstChild.data}catch(au){av="-"}j("TAME library error: Message from server:  "+aq+" ("+av+")");return}catch(at){av=0}if(typeof ar.normalize==="function"){ar.normalize()}if(aw.method==="ReadState"){al(aw)}else{if(aw.method==="Read"||aw.method==="ReadWrite"){switch(aw.indexGroup){case k.UploadInfo:Z(aw);break;case k.Upload:ag(aw);break;case k.SumRd:c(aw);break;case k.SumWr:y(aw);break;case k.SumRdWr:X(aw);break;default:x(aw)}}}if(typeof aw.reqDescr.oc==="function"){if(typeof aw.reqDescr.ocd==="number"){window.setTimeout(aw.reqDescr.oc,aw.reqDescr.ocd)}else{aw.reqDescr.oc()}}};this.getHandles=function(at){var az={},aA=[],aw=at.symbols.length,aB,ay,av,aq,ax,ar,au;at.readLength=aw*12;for(ay=0;ay<aw;ay++){aB=ai(k.HandleByName,4);aA=aA.concat(aB);aB=ai(0,4);aA=aA.concat(aB);aB=ai(4,4);aA=aA.concat(aB);aB=ai(at.symbols[ay].length,4);aA=aA.concat(aB)}for(ay=0;ay<aw;ay++){ar=at.symbols[ay].toUpperCase();r[ay]=ar;aB=[];for(au=0;au<ar.length;au++){aB[au]=ar.charCodeAt(au)}aA=aA.concat(aB)}if(aA.length>0){aq=n(aA)}az={method:"ReadWrite",indexGroup:k.SumRdWr,indexOffset:aw,pwrData:aq,reqDescr:at};u(az).send()};this.releaseHandles=function(ar){var ax={},ay=[],az=[],au=0,av=[],at=0,aw,aq;if(ar===undefined){ar={}}else{if(ar.symbols!==undefined){au=ar.symbols.length;for(aw=0;aw<au;aw++){av[aw]=ar.symbols[aw].toUpperCase()}}else{au=r.length;av=r}}ar.readLength=au*4;for(aw=0;aw<au;aw++){az=ai(k.ReleaseHandle,4);ay=ay.concat(az);az=ai(0,4);ay=ay.concat(az);az=ai(4,4);ay=ay.concat(az)}for(aw=0;aw<au;aw++){if(typeof O[av[aw]]==="number"){az=ai(O[av[aw]],4);ay=ay.concat(az)}else{j("TAME library error: Handle for symbol name "+av[aw]+" does not exist in handle cache!");throw"Releasing Handles aborted!"}}if(ay.length>0){aq=n(ay)}ar.items=av;ar.isRelHdlReq=true;ax={method:"ReadWrite",indexGroup:k.SumWr,indexOffset:au,pwrData:aq,reqDescr:ar};u(ax).send()};this.writeBool=function(aq){N("Write","BOOL",aq)};this.writeByte=function(aq){N("Write","BYTE",aq)};this.writeUsint=function(aq){N("Write","USINT",aq)};this.writeSint=function(aq){N("Write","SINT",aq)};this.writeWord=function(aq){N("Write","WORD",aq)};this.writeUint=function(aq){N("Write","UINT",aq)};this.writeInt=function(aq){N("Write","INT",aq)};this.writeInt1Dp=function(aq){N("Write","INT1DP",aq)};this.writeDword=function(aq){N("Write","DWORD",aq)};this.writeUdint=function(aq){N("Write","UDINT",aq)};this.writeDint=function(aq){N("Write","DINT",aq)};this.writeReal=function(aq){N("Write","REAL",aq)};this.writeLreal=function(aq){N("Write","LREAL",aq)};this.writeString=function(aq){N("Write","STRING",aq)};this.writeTime=function(aq){N("Write","TIME",aq)};this.writeTod=function(aq){N("Write","TOD",aq)};this.writeDate=function(aq){N("Write","DATE",aq)};this.writeDt=function(aq){N("Write","DT",aq)};this.readBool=function(aq){N("Read","BOOL",aq)};this.readByte=function(aq){N("Read","BYTE",aq)};this.readUsint=function(aq){N("Read","USINT",aq)};this.readSint=function(aq){N("Read","SINT",aq)};this.readWord=function(aq){N("Read","WORD",aq)};this.readUint=function(aq){N("Read","UINT",aq)};this.readInt=function(aq){N("Read","INT",aq)};this.readInt1Dp=function(aq){N("Read","INT1DP",aq)};this.readDword=function(aq){N("Read","DWORD",aq)};this.readUdint=function(aq){N("Read","UDINT",aq)};this.readDint=function(aq){N("Read","DINT",aq)};this.readReal=function(aq){N("Read","REAL",aq)};this.readLreal=function(aq){N("Read","LREAL",aq)};this.readString=function(aq){N("Read","STRING",aq)};this.readTime=function(aq){N("Read","TIME",aq)};this.readTod=function(aq){N("Read","TOD",aq)};this.readDate=function(aq){N("Read","DATE",aq)};this.readDt=function(aq){N("Read","DT",aq)};this.writeStruct=function(aq){ae("Write",aq)};this.readStruct=function(aq){ae("Read",aq)};this.writeArrayOfBool=function(aq){I("Write","BOOL",aq)};this.writeArrayOfByte=function(aq){I("Write","BYTE",aq)};this.writeArrayOfUsint=function(aq){I("Write","USINT",aq)};this.writeArrayOfSint=function(aq){I("Write","SINT",aq)};this.writeArrayOfWord=function(aq){I("Write","WORD",aq)};this.writeArrayOfUint=function(aq){I("Write","UINT",aq)};this.writeArrayOfInt=function(aq){I("Write","INT",aq)};this.writeArrayOfInt1Dp=function(aq){I("Write","INT1DP",aq)};this.writeArrayOfDword=function(aq){I("Write","DWORD",aq)};this.writeArrayOfUdint=function(aq){I("Write","UDINT",aq)};this.writeArrayOfDint=function(aq){I("Write","DINT",aq)};this.writeArrayOfReal=function(aq){I("Write","REAL",aq)};this.writeArrayOfLreal=function(aq){I("Write","LREAL",aq)};this.writeArrayOfString=function(aq){I("Write","STRING",aq)};this.writeArrayOfTime=function(aq){I("Write","TIME",aq)};this.writeArrayOfTod=function(aq){I("Write","TOD",aq)};this.writeArrayOfDate=function(aq){I("Write","DATE",aq)};this.writeArrayOfDt=function(aq){I("Write","DT",aq)};this.writeArrayOfStruct=function(aq){I("Write","STRUCT",aq)};this.readArrayOfBool=function(aq){I("Read","BOOL",aq)};this.readArrayOfByte=function(aq){I("Read","BYTE",aq)};this.readArrayOfUsint=function(aq){I("Read","USINT",aq)};this.readArrayOfSint=function(aq){I("Read","SINT",aq)};this.readArrayOfWord=function(aq){I("Read","WORD",aq)};this.readArrayOfUint=function(aq){I("Read","UINT",aq)};this.readArrayOfInt=function(aq){I("Read","INT",aq)};this.readArrayOfInt1Dp=function(aq){I("Read","INT1DP",aq)};this.readArrayOfDword=function(aq){I("Read","DWORD",aq)};this.readArrayOfUdint=function(aq){I("Read","UDINT",aq)};this.readArrayOfDint=function(aq){I("Read","DINT",aq)};this.readArrayOfReal=function(aq){I("Read","REAL",aq)};this.readArrayOfLreal=function(aq){I("Read","LREAL",aq)};this.readArrayOfString=function(aq){I("Read","STRING",aq)};this.readArrayOfTime=function(aq){I("Read","TIME",aq)};this.readArrayOfTod=function(aq){I("Read","TOD",aq)};this.readArrayOfDate=function(aq){I("Read","DATE",aq)};this.readArrayOfDt=function(aq){I("Read","DT",aq)};this.readArrayOfStruct=function(aq){I("Read","STRUCT",aq)};function ad(){var aq={method:"Read",indexGroup:k.UploadInfo,indexOffset:0,reqDescr:{readLength:8}};u(aq).send()}function Z(aw){var aq,ar,ax,au,at;try{aq=aw.xmlHttpReq.responseXML.documentElement;ar=T(aq.getElementsByTagName("ppData")[0].firstChild.data);ax=ar.substr(0,4);b=Y(ax,"DWORD");ax=ar.substr(4,4);v=Y(ax,"DWORD")}catch(av){j("TAME library error: Parsing of UploadInfo failed:"+av);return}at={method:"Read",indexGroup:k.Upload,indexOffset:0,reqDescr:{readLength:v}};u(at).send()}function ag(aI){var aq,aA=0,aF=4,aC=8,ay=12,av=30,au,aw,aH,az,aB,ar,aG,ax,at,aE;try{aq=aI.xmlHttpReq.responseXML.documentElement;au=T(aq.getElementsByTagName("ppData")[0].firstChild.data);for(az=0;az<b;az++){aw=au.substr(aA,4);aB=Y(aw,"DWORD");ar=au.substring(aA+av,(aA+aB)).split(String.fromCharCode(0));name=ar[0].toUpperCase();R[name]={typeString:ar[1],indexGroup:Y(au.substr(aA+aF,4),"DWORD"),indexOffset:Y(au.substr(aA+aC,4),"DWORD"),size:Y(au.substr(aA+ay,4),"DWORD")};aG=ar[1].split(" ");if(aG[0]==="ARRAY"){R[name].type=aG[0];ax=aG[1].substring(1,aG[1].length-1);ax=ax.split("..");R[name].arrStartIdx=parseInt(ax[0],10);ax=parseInt(ax[1],10)-parseInt(ax[0],10)+1;R[name].arrayLength=ax;at=aG[3].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[name].fullType=aG[0]+"."+ax+"."+at[0]+"."+at[1];R[name].stringLength=parseInt(at[1],10)}else{R[name].fullType=aG[0]+"."+ax+"."+at[0]}R[name].itemSize=R[name].size/ax;R[name].arrayDataType="USER";for(aE in C){if(C.hasOwnProperty(aE)){if(at[0]===aE){R[name].arrayDataType=at[0]}}}if(R[name].arrayDataType==="USER"){R[name].dataType=at[0]}}else{at=aG[0].split("(");if(at[1]!==undefined){at[1]=at[1].substr(0,at[1].length-1);R[name].fullType=at[0]+"."+at[1];R[name].stringLength=parseInt(at[1],10)}else{R[name].fullType=at[0]}R[name].type="USER";for(aE in C){if(C.hasOwnProperty(aE)){if(at[0]===aE){R[name].type=at[0]}}}if(R[name].type==="USER"){R[name].dataType=at[0]}}aA+=aB}ac.symTableReady=true;j("TAME library info: End of fetching the symbols.");j("TAME library info: Symbol table ready.");e.onReady()}catch(aD){j("TAME library error: Parsing of uploaded symbol information failed:"+aD);return}}function J(){var au=ab(),aA=[],ar,aq,az,aw,av,ay,at,ax;j("TAME library info: Start reading the TPY file.");au.open("GET",e.configFileUrl,true);au.setRequestHeader("Content-Type","text/xml");au.onreadystatechange=function(){if((au.readyState===4)&&(au.status===200)){if(typeof DOMParser=="function"){try{ar=(new DOMParser()).parseFromString(au.responseText,"text/xml")}catch(aG){j("TAME library error: Creating a DOM object from TPY failed:"+aG);return}}else{j("TAME library error: Can't parse the symbol file cause your brower does not provide a DOMParser function.")}if(typeof e.amsNetId!=="string"||typeof e.amsPort!=="string"||a===0){j("TAME library info: Start reading the service information from the TPY file.");try{A={netId:ar.getElementsByTagName("NetId")[0].childNodes[0].nodeValue,port:ar.getElementsByTagName("Port")[0].childNodes[0].nodeValue};ax=ar.getElementsByTagName("TwinCATVersion")[0].childNodes[0].nodeValue.charAt(0);if(ax==="2"){A.alignment=parseInt(ar.getElementsByTagName("PackSize")[0].childNodes[0].nodeValue,10)}else{if(ax==="3"){A.alignment=8}else{j("TAME library error: Could not determine the TwinCAT version.")}}j("TAME library info: End of reading the service information from the TPY file.")}catch(aG){j("TAME library error: An error occured while reading service information from the TPY file:");j(aG)}}else{j("TAME library info: NetId, port and alignment manually set. Skip reading the service information from the TPY file.")}if(e.forceUploadUsage!==true){j("TAME library info: Start reading the symbols from the TPY file.");try{az=ar.getElementsByTagName("Symbols")[0];aA=az.getElementsByTagName("Symbol");for(var aC=0;aC<aA.length;aC++){aq=aA[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();R[aq]={typeString:aA[aC].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),indexGroup:parseInt(aA[aC].getElementsByTagName("IGroup")[0].childNodes[0].nodeValue,10),indexOffset:parseInt(aA[aC].getElementsByTagName("IOffset")[0].childNodes[0].nodeValue,10),bitSize:parseInt(aA[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};R[aq].size=(R[aq].bitSize>=8)?R[aq].bitSize/8:R[aq].bitSize;aw=R[aq].typeString.split(" ");if(aw[0]==="ARRAY"){R[aq].type=aw[0];av=aw[1].substring(1,aw[1].length-1);av=av.split("..");R[aq].arrStartIdx=parseInt(av[0],10);av=parseInt(av[1],10)-parseInt(av[0],10)+1;R[aq].arrayLength=av;ay=aw[3].split("(");if(ay[1]!==undefined){ay[1]=ay[1].substr(0,ay[1].length-1);R[aq].fullType=aw[0]+"."+av+"."+ay[0]+"."+ay[1];R[aq].stringLength=parseInt(ay[1],10)}else{R[aq].fullType=aw[0]+"."+av+"."+ay[0]}R[aq].itemSize=R[aq].size/av;R[aq].arrayDataType="USER";for(at in C){if(C.hasOwnProperty(at)){if(ay[0]===at){R[aq].arrayDataType=ay[0]}}}if(R[aq].arrayDataType==="USER"){R[aq].dataType=ay[0]}}else{ay=aw[0].split("(");if(ay[1]!==undefined){ay[1]=ay[1].substr(0,ay[1].length-1);R[aq].fullType=ay[0]+"."+ay[1];R[aq].stringLength=parseInt(ay[1],10)}else{R[aq].fullType=ay[0]}R[aq].type="USER";for(at in C){if(C.hasOwnProperty(at)){if(ay[0]===at){R[aq].type=ay[0]}}}if(R[aq].type==="USER"){R[aq].dataType=ay[0]}}}ac.symTableReady=true;j("TAME library info: End of reading the symbols from the TPY file.");j("TAME library info: Symbol table ready.")}catch(aG){j("TAME library error: An error occured while parsing the symbol file:");j(aG)}}else{j("TAME library info: Reading the symbols from the TPY file is deactivated.")}var aD,aE,aI,aF,aH;if(true){j("TAME library info: Start reading the data types from the TPY file.");try{aD=ar.getElementsByTagName("DataTypes")[0];aE=aD.getElementsByTagName("DataType");for(var aC=0;aC<aE.length;aC++){aH=aE[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aq=aH.split(" ")[0];if(aq==="ARRAY"){ap[aH]={bitSize:parseInt(aE[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10)};ap[aH].size=ap[aH].bitSize/8}}for(var aC=0;aC<aE.length;aC++){aH=aE[aC].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();aq=aH.split(" ")[0];if(aq!=="ARRAY"){ap[aq]={bitSize:parseInt(aE[aC].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),subItems:{}};ap[aq].size=ap[aq].bitSize/8;aI=aE[aC].getElementsByTagName("SubItem");for(var aB=0;aB<aI.length;aB++){aF=aI[aB].getElementsByTagName("Name")[0].childNodes[0].nodeValue.toUpperCase();ap[aq].subItems[aF]={typeString:aI[aB].getElementsByTagName("Type")[0].childNodes[0].nodeValue.toUpperCase(),pointer:aI[aB].getElementsByTagName("Type")[0].hasAttribute("Pointer"),bitSize:parseInt(aI[aB].getElementsByTagName("BitSize")[0].childNodes[0].nodeValue,10),};if(aI[aB].getElementsByTagName("BitOffs")[0]!==undefined){ap[aq].subItems[aF].bitOffset=parseInt(aI[aB].getElementsByTagName("BitOffs")[0].childNodes[0].nodeValue,10)}ap[aq].subItems[aF].size=(ap[aq].subItems[aF].bitSize>=8)?ap[aq].subItems[aF].bitSize/8:ap[aq].subItems[aF].bitSize;aw=ap[aq].subItems[aF].typeString.split(" ");if(aw[0]==="ARRAY"){ap[aq].subItems[aF].type=aw[0];av=aw[1].substring(1,aw[1].length-1);av=av.split("..");ap[aq].subItems[aF].arrStartIdx=parseInt(av[0],10);av=parseInt(av[1],10)-parseInt(av[0],10)+1;ap[aq].subItems[aF].arrayLength=av;ay=aw[3].split("(");if(ay[1]!==undefined){ay[1]=ay[1].substr(0,ay[1].length-1);ap[aq].subItems[aF].fullType=aw[0]+"."+av+"."+ay[0]+"."+ay[1];ap[aq].subItems[aF].stringLength=parseInt(ay[1],10)}else{ap[aq].subItems[aF].fullType=aw[0]+"."+av+"."+ay[0]}ap[aq].subItems[aF].bitSize=ap[ap[aq].subItems[aF].typeString].bitSize;ap[aq].subItems[aF].size=ap[ap[aq].subItems[aF].typeString].size;ap[aq].subItems[aF].itemSize=ap[aq].subItems[aF].size/av;ap[aq].subItems[aF].arrayDataType="USER";for(at in C){if(C.hasOwnProperty(at)){if(ay[0]===at){ap[aq].subItems[aF].arrayDataType=ay[0]}}}if(ap[aq].subItems[aF].arrayDataType==="USER"){ap[aq].subItems[aF].dataType=ay[0]}}else{ay=aw[0].split("(");if(ay[1]!==undefined){ay[1]=ay[1].substr(0,ay[1].length-1);ap[aq].subItems[aF].fullType=ay[0]+"."+ay[1];ap[aq].subItems[aF].stringLength=parseInt(ay[1],10)}else{ap[aq].subItems[aF].fullType=ay[0]}ap[aq].subItems[aF].type="USER";for(at in C){if(C.hasOwnProperty(at)){if(ay[0]===at){ap[aq].subItems[aF].type=ay[0]}}}if(ap[aq].subItems[aF].type==="USER"){ap[aq].subItems[aF].dataType=ay[0]}}}}}ac.dataTypeTableReady=true;j("TAME library info: End of reading the data types from the TPY file.");j("TAME library info: Data type table ready.");w()}catch(aG){j("TAME library error: An error occured while creating the data type information:");j("Type: "+aH);j("SubItem: "+aF);j(aG)}}}};au.send(null)}function t(){if(typeof e.amsNetId!=="string"){e.amsNetId=A.netId;j("TAME library info: No NetId definition found. NetId from TPY file is used.")}if(typeof e.amsPort!=="string"){e.amsPort=A.port;j("TAME library info: No AMS port definition found. Port number from TPY file is used.")}if(a===0){if(A.alignment!==undefined){a=A.alignment;j("TAME library info: No alignment parameter found. Alignment from TPY file is used.")}else{a=1;j("TAME library warning: Can't get a value for the data aligment. Default value for alignment is used (1). This works only with TC2 and x86 processors.")}}if(a!==1&&a!==4&&a!==8){j("TAME library warning: The value for the alignment should be 1, 4 or 8.")}j("TAME library info: Target information: NetId: "+e.amsNetId+", AMS port: "+e.amsPort+" , alignment: "+a)}function w(){t();if(typeof e.configFileUrl!="string"||e.forceUploadUsage===true){j("TAME library info: Start fetching the symbols from PLC.");try{ad()}catch(aq){j("TAME library error: Could'nt fetch the symbol information from the PLC:"+aq);return}}else{e.onReady()}}if(e.dontFetchSymbols===true){j("TAME library warning: Reading of the UploadInfo and the TPY file deactivated. Symbol Table could not be created.");if(a!==1&&a!==4&&a!==8){j("TAME library warning: The value for the alignment should be 1, 4 or 8.")}j("TAME library info: Target information: NetId: "+e.amsNetId+", AMS port: "+e.amsPort+" , alignment: "+a)}else{if(typeof e.configFileUrl=="string"){j("TAME library info: Fetching the TPY file from the webserver.");J()}else{w()}}};TAME.WebServiceClient.createClient=function(a){return new TAME.WebServiceClient(a)};